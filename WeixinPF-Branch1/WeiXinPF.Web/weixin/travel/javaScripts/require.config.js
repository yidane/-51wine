/*!
 * headroom.js v0.7.0 - Give your page some headroom. Hide your header until you need it
 * Copyright (c) 2014 Nick Williams - http://wicky.nillia.ms/headroom.js
 * License: MIT
 */

define(["http://webresource.c-ctrip.com/ResCRMOnline/R5/basewidget/main.js"],function(){var t="/webapp/ticket/dest/webresource/",e={paths:{Headroom:t+"gibbon/javascript/3rd/headroom",GAmap:t+"gibbon/javascript/common/amap",GCommand:t+"gibbon/javascript/common/command",GController:t+"gibbon/javascript/controller/controller",GCityService:t+"gibbon/javascript/services/abstract.cityservice",GCtripCityService:t+"gibbon/javascript/services/ctrip.cityservice",GRuntimeService:t+"gibbon/javascript/services/runtimeservice",GHistoryManager:t+"gibbon/javascript/services/historymanager",GPageManager:t+"gibbon/javascript/services/pagemanager",GStoreFactory:t+"gibbon/javascript/stores/store.factory",GStoreConfig:t+"gibbon/javascript/stores/store.config",GModelFactory:t+"gibbon/javascript/models/model.factory",GModelConfig:t+"gibbon/javascript/models/model.config",GView:t+"gibbon/javascript/views/abstract.view",GBulkLazyLoad:t+"gibbon/javascript/util/bulklazyload",GFormat:t+"gibbon/javascript/util/format",GLogger:t+"gibbon/javascript/util/logger",GRouterAdapter:t+"gibbon/javascript/util/router.adapter",GTraceLog:t+"gibbon/javascript/util/tracelog",GUrlUtil:t+"gibbon/javascript/util/urlutil",GScrollDrag:t+"gibbon/javascript/util/scrolldrag",GSearch:t+"widget/search2",TicketModel:t+"models/ticket.model",TicketStore:t+"stores/ticket.store",TicketAbstractStore:t+"stores/abstract.store",TicketCityStoreConfig:t+"stores/ticket.city.store.config",TicketStoreConfig:t+"stores/ticket.store.config",TicketCommon:t+"common/common",TicketCommand:t+"common/command",TicketConfig:t+"appconfig/config",country:t+"appconfig/const/country",errorMsg:t+"appconfig/const/errormsg",formItem:t+"appconfig/const/formitem",listConst:t+"appconfig/const/list.const",pageId:t+"appconfig/const/pageid",payment:t+"services/payment",ubt:t+"appconfig/const/ubt",traveler:t+"services/traveler",indexSearch:t+"views/index.search",indexSideBar:t+"views/index.sidebar",citylistIndexer:t+"views/citylist.indexer",listEmpty:t+"views/list.empty",listBottom:t+"views/list.bottom",listSearch:t+"views/list.search",ctmCfg:t+"appconfig/const/ctm",ctm:t+"gibbon/javascript/util/ctm",TicketTraceLog:t+"util/tracelog",TicketUrlUtil:t+"util/urlutil",TicketUtil:t+"util/util",TicketCityService:t+"services/ticket.cityservice",TicketCommonService:t+"services/commonservice",PageManager:t+"services/pagemanager",ScrollManager:t+"services/scrollmanager",HistoryManager:t+"services/historymanager",TicketSearch:t+"widget/search",TicketList:t+"widget/abstract.list",TicketView:t+"widget/abstract.view",TicketBottom:t+"widget/bottom",tLazyLoad:t+"widget/tlazyload"}};require.config(e)}),define("Headroom",[],function(){"use strict";function t(t){this.callback=t,this.ticking=!1}function e(t){return t&&"undefined"!=typeof window&&(t===window||t.nodeType)}function i(t){if(arguments.length<=0)throw new Error("Missing arguments in extend function");var n,r,a=t||{};for(r=1;r<arguments.length;r++){var o=arguments[r]||{};for(n in o)a[n]="object"!=typeof a[n]||e(a[n])?a[n]||o[n]:i(a[n],o[n])}return a}function n(t){return t===Object(t)?t:{down:t,up:t}}function r(e,a){a=i(a,r.options),this.lastKnownScrollY=0,this.elem=e,this.debouncer=new t(this.update.bind(this)),this.tolerance=n(a.tolerance),this.classes=a.classes,this.offset=a.offset,this.scroller=a.scroller,this.initialised=!1,this.onPin=a.onPin,this.onUnpin=a.onUnpin,this.onTop=a.onTop,this.onNotTop=a.onNotTop}window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame,function(){for(var t=0,e=["ms","moz","webkit","o"],i=0;i<e.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"]||window[e[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var i=(new Date).getTime(),n=Math.max(0,16-(i-t)),r=window.setTimeout(function(){e(i+n)},n);return t=i+n,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();var a={bind:!!function(){}.bind,classList:"classList"in document.documentElement,rAF:!0};return t.prototype={constructor:t,update:function(){this.callback&&this.callback(),this.ticking=!1},requestTick:function(){this.ticking||(requestAnimationFrame(this.rafCallback||(this.rafCallback=this.update.bind(this))),this.ticking=!0)},handleEvent:function(){this.requestTick()}},r.prototype={constructor:r,init:function(){return r.cutsTheMustard?(this.elem.classList.add(this.classes.initial),setTimeout(this.attachEvent.bind(this),100),this):void 0},destroy:function(){var t=this.classes;this.initialised=!1,this.elem.classList.remove(t.unpinned,t.pinned,t.top,t.initial),this.scroller.removeEventListener("scroll",this.debouncer,!1)},attachEvent:function(){this.initialised||(this.lastKnownScrollY=this.getScrollY(),this.initialised=!0,this.scroller.addEventListener("scroll",this.debouncer,!1),this.debouncer.handleEvent())},unpin:function(){var t=this.elem.classList,e=this.classes;(t.contains(e.pinned)||!t.contains(e.unpinned))&&(t.add(e.unpinned),t.remove(e.pinned),this.onUnpin&&this.onUnpin.call(this))},pin:function(){var t=this.elem.classList,e=this.classes;t.contains(e.unpinned)&&(t.remove(e.unpinned),t.add(e.pinned),this.onPin&&this.onPin.call(this))},top:function(){var t=this.elem.classList,e=this.classes;t.contains(e.top)||(t.add(e.top),t.remove(e.notTop),this.onTop&&this.onTop.call(this))},notTop:function(){var t=this.elem.classList,e=this.classes;t.contains(e.notTop)||(t.add(e.notTop),t.remove(e.top),this.onNotTop&&this.onNotTop.call(this))},getScrollY:function(){return void 0!==this.scroller.pageYOffset?this.scroller.pageYOffset:void 0!==this.scroller.scrollTop?this.scroller.scrollTop:(document.documentElement||document.body.parentNode||document.body).scrollTop},getViewportHeight:function(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight},getDocumentHeight:function(){var t=document.body,e=document.documentElement;return Math.max(t.scrollHeight,e.scrollHeight,t.offsetHeight,e.offsetHeight,t.clientHeight,e.clientHeight)},getElementHeight:function(t){return Math.max(t.scrollHeight,t.offsetHeight,t.clientHeight)},getScrollerHeight:function(){return this.scroller===window||this.scroller===document.body?this.getDocumentHeight():this.getElementHeight(this.scroller)},isOutOfBounds:function(t){var e=0>t,i=t+this.scroller.clientHeight>this.getScrollerHeight();return e||i},toleranceExceeded:function(t,e){return Math.abs(t-this.lastKnownScrollY)>=this.tolerance[e]},shouldUnpin:function(t,e){var i=t>this.lastKnownScrollY,n=t>=this.offset;return i&&n&&e},shouldPin:function(t,e){var i=t<this.lastKnownScrollY,n=t<=this.offset;return i&&e||n},update:function(){var t=this.getScrollY(),e=t>this.lastKnownScrollY?"down":"up",i=this.toleranceExceeded(t,e);this.isOutOfBounds(t)||(t<=this.offset?this.top():this.notTop(),this.shouldUnpin(t,i)?this.unpin():this.shouldPin(t,i)&&this.pin(),this.lastKnownScrollY=t)}},r.options={tolerance:{up:0,down:0},offset:0,scroller:window,classes:{pinned:"headroom--pinned",unpinned:"headroom--unpinned",top:"headroom--top",notTop:"headroom--not-top",initial:"headroom"}},r.cutsTheMustard="undefined"!=typeof a&&a.rAF&&a.bind&&a.classList,r}),define("GAmap",["cUtility"],function(t){function e(){if(!r){r=!0;var t=document.createElement("script");t.type="text/javascript",t.src="http://webapi.amap.com/maps?v=1.2&key=0b895f63ca21c9e82eb158f46fe7f502&callback=__init_amap",document.body.appendChild(t)}}var i={},n=!1,r=!1,a=[];return i.load=function(i){return t.isInApp||n?i():(a.push(i),void e())},window.__init_amap=function(){a.forEach(function(t){t()}),a=[],n=!0},i}),define("GCommand",["cCoreInherit"],function(t){var e={},i=new t.Class({validateOptions:function(t,i){var n=e[t].args;for(var r in n)if(n[r].require&&!i[r])return"the argument "+r+" is required!";for(var a in i)if("help"!==a){if(!n[a])return"the argument "+a+" is redundant!";if("[object RegExp]"===Object.prototype.toString.call(n[a].reg)&&!n[a].reg.test(i[a]))return"the argument "+a+"'s value ["+i[a]+"] is invalid!";if("[object Function]"===Object.prototype.toString.call(n[a].validate)&&!n[a].validate(i[a]))return"the argument "+a+"'s value ["+i[a]+"] is invalid!"}},__propertys__:function(){this.aliasMap={}},initialize:function(t){_.extend(e,t);var i=this,n=function(t){if(i.aliasMap[t])throw new Error('duplicated alias name: "'+t+'"');i.aliasMap[t]=a};for(var r in e)e[r].alias=e[r].alias||[],e[r].args=e[r].args||{};for(var a in e){if(!this[a])throw new Error('the command "'+a+'" is not exists!');(e[a].alias||[]).forEach(n)}},getShell:function(t,i){var n=this[t]?t:this.aliasMap[t];if(!n)return t+" is invalid";for(var r in i)!i[r]&&e[n].args[r]&&e[n].args[r]["default"]&&(i[r]=e[n].args[r]["default"]);var a=this.validateOptions(n,i);return a||this[n]},getShellByKeyword:function(t){var e=t.match(/^(\w+)(\s+-{1,2}\w+(\s+\w+)?)*$/i);if(!e)return!1;var i=e[1],n=t.match(/-{1,2}\w+(\s+\w+)?/gi)||[],r={};n.forEach(function(t){var e=t.split(/\s+/);r[e[0].replace(/-/g,"")]=e[1]});var a=this.getShell(i,r);if(r.hasOwnProperty("help")){var o=this[i]?i:this.aliasMap[i];return{command:o?this.help(o):i+" is invalid!",options:r}}return{command:a,options:r}},executeShell:function(t){return"function"==typeof t.command?t.command(t.options):t.command},execute:function(t){if(t=$.trim(t),t=t.toLowerCase(),"help"===t)return this.help();var e=this.getShellByKeyword(t);return e?this.executeShell(e):"illegal shell command!!"},help:function(t){var i=[];if(t){var n=e[t];if(!n)return"illegal shell command!!";i.push(n.description),i.push("alias:	"+n.alias),i.push("arguments:");var r=n.args;for(var a in r)i.push(a+"	"+r[a].description)}else for(var o in e)i.push(o+"	["+e[o].alias+"]	"+e[o].description);return i.join("\n")}});return i.getInstance=function(){return this.instance||(this.instance=new this)},i}),define("GController",["cCoreInherit"],function(t){"use strict";var e=function(t){return!!t&&"[object Array]"===Object.prototype.toString.call(t)},i=function(t){return!!t&&"function"==typeof t},n=function(t){var e=[];for(var i in t)e.push(i);return e},r=function(t,e,i){return!t.validate||t.validate.call(t.thisObj,e,i)},a={AND:"and",OR:"or",WATERFALL:"waterfall"},o={},s=new t.Class({__propertys__:function(){},initialize:function(t){this.type=t.type,this.notificationNames=t.notificationNames,this.output=t.output,this.thisObj=t.thisObj,this.validate=t.validate,this.type!==a.OR&&(this.notifications={}),this.type===a.WATERFALL&&(this.notificationQuery=[])}}),c=new t.Class({__propertys__:function(){this.notificationMap={}},initialize:function(){},createGate:function(t,e,i,n,r){var o=new s({type:t||a.OR,notificationNames:e,output:i,thisObj:n,validate:r});return o},addNotificationListener:function(t,e,i,n){return this.addOrNotificationListener([t],e,i,n)},addOrNotificationListener:function(t,e,i,n){var r=this.createGate(a.OR,t,e,i,n);return this.addGateToBus(r)},addAndNotificationListener:function(t,e,i,n){var r=this.createGate(a.AND,t,e,i,n);return this.addGateToBus(r)},addWaterfallNotificationListener:function(t,e,i,n){var r=this.createGate(a.WATERFALL,t,e,i,n);return this.addGateToBus(r)},addGateToBus:function(t){return t.notificationNames.forEach(function(e){var i=this.notificationMap[e]||[];i.indexOf(t)<0&&i.push(t),this.notificationMap[e]=i},this),t},removeGateFromBus:function(t){t&&t.notificationNames.forEach(function(e){var i=this.notificationMap[e];return i&&i.length?void(this.notificationMap[e]=i.filter(function(e){return e!==t})):void delete this.notificationMap[e]},this)},removeAllGatesByName:function(t){return e(t)?t.forEach(function(t){this.removeAllGatesByName(t)},this):void delete this.notificationMap[t]},removeAllGates:function(){this.notificationMap={}},removeGate:function(t,e){if(!t&&e)return this.removeGateFromBus(e);if(t&&!e)return this.removeAllGatesByName(t);if(!t&&!e)return this.removeAllGates();var i=this.notificationMap[t];return i&&i.length?void(this.notificationMap[t]=i.filter(function(t){return t!==e})):void delete this.notificationMap[t]},hasGate:function(t,e){var i=this.getGatesByName(t);return i&&i.length?e?-1!==i.indexOf(e):!0:!1},hasGateWithOutput:function(t,e){var i=this.getGatesByName(t);return i&&i.length?i.some(function(t){return t.output===e}):!1},getGatesByName:function(t){return this.notificationMap[t]},sendNotification:function(t,i){if(e(t))return t.forEach(function(t){this.sendNotification(t,i)},this);var n=this.notificationMap[t]||[];n.forEach(function(e){this.sendNotificationToGate(e,t,i)},this)},sendNotificationToGate:function(t,e,i){switch(t.type){case a.AND:this.sendNotificationToAndGate(t,e,i);break;case a.OR:this.sendNotificationToOrGate(t,e,i);break;case a.WATERFALL:this.sendNotificationToWaterfallGate(t,e,i)}},sendNotificationToAndGate:function(t,e,i){if(!(t.notificationNames.indexOf(e)<0)){t.notifications[e]=i;var a=n(t.notifications).sort(),o=t.notificationNames.slice().sort().every(function(t,e){return a[e]===t},this);o&&r(t,e,i)&&(this._output(t,e,t.notifications),t.notifications={})}},sendNotificationToOrGate:function(t,e,i){t.notificationNames.indexOf(e)<0||r(t,e,i)&&this._output(t,e,i)},sendNotificationToWaterfallGate:function(t,e,i){if(!(t.notificationNames.indexOf(e)<0)){t.notifications[e]=i;var n=t.notificationQuery;for(n.push(e);n.length>t.notificationNames.length;)n.shift();var a=t.notificationNames.every(function(t,e){return t===n[e]});a&&r(t,e,i)&&(this._output(t,e,t.notifications),t.notificationQuery=[],t.notifications={})}},_output:function(t,e,n){i(t.output)?t.output.call(t.thisObj,e,n):this.sendNotificationToGate(t.output,e,n)}});return c.getInstance=function(t){return t=t||"application",o[t]||(o[t]=new this)},window.getController=c.getInstance,c}),define("GLogger",["cCoreInherit"],function(t){"use strict";var e=require("cGuider"),i={INFO:"info",LOG:"log",WARN:"warn",ERROR:"error"},n="GIBBON",r={logServerIP:"127.0.0.1",logServerPort:"80",logAble:!1,guiderPrintAble:!1},a=new t.Class({__propertys__:function(){},initialize:function(t){this.config=$.extend(r,t),window.success_jsonpCallback=function(){}},info:function(t,e,n){this._request(i.INFO,t,e,n)},log:function(t,e,n){this._request(i.LOG,t,e,n)},warn:function(t,e,n){this._request(i.WARN,t,e,n)},error:function(t,e,n){this._request(i.ERROR,t,e,n)},_request:function(t,i,r,a){a=a||n,this.config.logAble&&$.ajax({url:this._getUrl()+"?type="+t+"&msg="+i+"&data="+JSON.stringify(r)+"&source="+a,dataType:"jsonp",jsonpCallback:"success_jsonpCallback",success:function(){},error:function(){},timeout:8e3}),this.config.consoleAble&&console[t]&&void 0,this.config.guiderPrintAble&&e.print({log:i})},_getUrl:function(){return"http://"+this.config.logServerIP+":"+this.config.logServerPort+"/log"}});return a.getInstance=function(t){return this.instance||(this.instance=new this(t))},a}),define("GStoreConfig",{GeoLocationStore:{key:"POSITION_CITY"},GGeoLocationStore:{key:"U_GIBBON_GEOLOCATION",lifeTime:"10M",setPosInfo:function(t){for(var e in t)this.setAttr(e,t[e])}},GSelectedCityStore:{key:"U_GIBBON_SELECTED_CITY",lifeTime:"30D",setCityInfo:function(t){for(var e in t)this.setAttr(e,t[e])}},GLastGeoCityStore:{key:"U_GIBBON_LASTGEOCITY",lifeTime:"1D",setCityInfo:function(t){for(var e in t)this.setAttr(e,t[e])}},GGeoCityStore:{key:"U_GIBBON_GEOCITY",lifeTime:"1D",setCityInfo:function(t){for(var e in t)this.setAttr(e,t[e])}}}),define("GStoreFactory",["cStore","cCoreInherit","GStoreConfig"],function(t,e,i){var n=function(i,n){var r={initialize:function($super,t){$super(t)}},a=function(){_.extend(this,i)};return r.__propertys__=a,new e.Class(n||t,r)};return{createStores:function(t,e){t=t||i;var r={};for(var a in t)r[a]=n(t[a],e);return r}}}),define("GCityService",["require","cCoreInherit","GController","GLogger","GStoreFactory"],function(t){var e=t("cCoreInherit"),i=t("GController"),n=t("GLogger"),r=t("GStoreFactory"),a=r.createStores(),o=new e.Class({_parseHack:function(t){return t&&(t.id=parseInt(t.id)),t},getSelectedCity:function(){return this._parseHack(this.selectedCityStore.get())},setSelectedCity:function(t){this.selectedCityStore.setCityInfo(this._parseHack(t))},getLastGeoCity:function(){return this.lastGeoCityStore.get()},setLastGeoCity:function(t){this.lastGeoCityStore.setCityInfo(this._parseHack(t))},getGeoCity:function(){return this._parseHack(this.geoCityStore.get())},setGeoCity:function(t){this.geoCityStore.setCityInfo(this._parseHack(t))},getGoeLocation:function(){return this.geoLocationStore.get()},__propertys__:function(){this.isPositioning=!1},initialize:function(t){this.geoLocationStore=(t.geoLocationStore||a.GGeoLocationStore).getInstance(),this.selectedCityStore=(t.selectedCityStore||a.GSelectedCityStore).getInstance(),this.lastGeoCityStore=(t.lastGeoCityStore||a.GLastGeoCityStore).getInstance(),this.geoCityStore=(t.geoCityStore||a.GGeoCityStore).getInstance(),this.controller=i.getInstance(),this.logger={name:"cityservice"};var e=n.getInstance(t);["info","log","warn","error"].forEach(function(t){this.logger[t]=function(){var i=[].slice.call(arguments),n=i.shift();e[t].call(e,n,i,this.name)}},this)},position:function(){throw new Error("abstract method")},reposition:function(){throw new Error("abstract method")},unPosition:function(){throw new Error("abstract method")},posComplete:function(){this.isPositioning=!1;var t=this.geoLocationStore.get()||{};t.lng!==arguments[0]&&t.lat!==arguments[1]&&(this.geoLocationStore.removeAttr("address"),this.geoLocationStore.removeAttr("location")),this.geoLocationStore.setPosInfo({lng:arguments[0],lat:arguments[1]}),this.controller.sendNotification(o.POSITION_SUCCESS,this.geoLocationStore.get())},posError:function(){this.isPositioning=!1,this.controller.sendNotification(o.POSITION_ERROR,[].slice.call(arguments))},onComplete:function(t){this.isPositioning=!1,this.geoLocationStore.setPosInfo(t),this.controller.sendNotification(o.ADDRESS_SUCCESS,t)},onError:function(){this.isPositioning=!1,this.controller.sendNotification(o.ADDRESS_ERROR,[].slice.call(arguments))},onCityComplete:function(t){this.isPositioning=!1,t&&t.CityEntities&&t.CityEntities[0]&&(t={id:parseInt(t.CityEntities[0].CityID),name:t.CityEntities[0].CityName}),t&&t.id&&t.name?(this.setGeoCity(t),this.controller.sendNotification(o.CITYINFO_SUCCESS,t)):this.controller.sendNotification(o.CITYINFO_ERROR,null)},onCityError:function(t,e){this.isPositioning=!1,this.controller.sendNotification(o.CITYINFO_ERROR,[t,e])}});return o.getInstance=function(){return this.instance||(this.instance=new this)},o.POSITION_START="POSITION_START",o.POSITION_SUCCESS="POSITION_SUCCESS",o.ADDRESS_SUCCESS="ADDRESS_SUCCESS",o.ADDRESS_ERROR="ADDRESS_ERROR",o.POSITION_ERROR="POSITION_ERROR",o.CITYINFO_SUCCESS="CITY_INFO_SUCCESS",o.CITYINFO_ERROR="CITY_INFO_ERROR",o}),define("GCtripCityService",["require","cCoreInherit","cGeoService","GCityService"],function(t){var e=t("cCoreInherit"),i=t("cGeoService"),n=t("GCityService"),r=i.GeoLocation,a=new e.Class(n,{position:function(t,e){this.isPositioning||(t=t||"ticket/position",this.isPositioning=!0,this._startPosition(t,!!e))},reposition:function(t){this.position(t,!0)},unPosition:function(t){t=t||"ticket/position",r.UnSubscribe(t)},_startPosition:function(t,e){r.Subscribe(t,{onStart:function(){},onPosComplete:this.posComplete,onPosError:this.posError,onComplete:this.onComplete,onError:this.onError,onCityComplete:this.onCityComplete,onCityError:this.onCityError},this,!!e)}});return a}),define("GRuntimeService",["cUtilHybrid"],function(t){return{getRunTime:function(){if(Lizard.isHybrid)return t.isPreProduction();var e=location.href;return e.match(/ticket\.m\.ctrip\.com/i)?1:e.match(/m\.ctrip\.com/i)?3:e.match(/(m\.fat|m\.fws|localhost|172\.16|127\.0|192\.168)/i)?0:e.match(/m\.uat/i)?2:e.match(/m\.lpt/i)?4:3}}}),define("GHistoryManager",["require","cCoreInherit"],function(t){var e=t("cCoreInherit"),i=new e.Class({initialize:function(t){this.next=t.next,this.preview=t.preview,this.data=t.data,this.historyList=t.historyList},getNext:function(){return this.next},setNext:function(t){this.next=t},getPreview:function(){return this.preview},setPreview:function(t){this.preview=t},getData:function(){return this.data},setData:function(t){this.data=t,this.historyList.saveNodes()},disconnect:function(){this.setNext(null),this.setPreview(null)},equal:function(t){return this.getData().name===t.getData().name}}),n=new e.Class({initialize:function(t){this.store=t.store,this.historyList=t.historyList,this.createNodes()},findNodeByName:function(t){if(this.head){var e=this.head;if(e.getData().name===t)return e;for(;e.getNext();)if(e=e.getNext(),e.getData().name===t)return e}},insertBefore:function(t,e){var i=t.getPreview();e.setNext(t),t.setPreview(e),i&&(i.setNext(e),e.setPreview(i)),t.equal(this.head)&&this.setHead(e),this.saveNodes()},insertAfter:function(t,e){var i=t.getNext();e.setPreview(t),t.setNext(e),i&&(i.setPreview(e),e.setNext(i)),this.saveNodes()},replace:function(t,e){!e&&this.remove(t);var i=t.getPreview(),n=t.getNext();e.setNext(n),e.setPreview(i),i&&i.setNext(e),n&&n.setPreview(e),this.saveNodes()},remove:function(t){if(t){var e=t.getPreview(),i=t.getNext();e&&e.setNext(i),i&&i.setPreview(e),t.equal(this.head)&&this.setHead(i),this.saveNodes()}},getHead:function(){return this.head},setHead:function(t){this.head=t,this.saveNodes()},getLast:function(){for(var t=this.head;t.getNext();)t=t.getNext();return t},append:function(t){var e=this.getLast();e?(e.setNext(t),t.setPreview(e)):this.head=t,this.saveNodes()},saveNodes:function(){for(var t=[],e=this.head;e;)t.push(e.getData()),e=e.getNext();this.store.set(t)},createNodes:function(){var t=this.store.get();if(t&&t.length){for(var e=0,n=t.length;n>e;e++)t[e]=new i({data:t[e],historyList:this.historyList});for(e=0;n>e;e++)t[e].setPreview(t[e-1]),t[e].setNext(t[e+1]);this.head=t[0]}}}),r=new e.Class({getHistoryStore:function(){throw new Error("abstract method")},getPageNameRegs:function(){throw new Error("abstract method")},getDefaultNode:function(){return new i({data:{url:Lizard.appBaseUrl+"index",name:"index"},historyList:this.historyList})},initialize:function(){this.historyList=new n({store:this.getHistoryStore(),historyList:this})},getPageNameByUrl:function(t){var e=this.getPageNameRegs(),i=t.split("?")[0];i=i.replace(Lizard.appBaseUrl,"");for(var n in e)if(_.isFunction(e[n])&&e[n].call(null,n)||_.isRegExp(e[n])&&i.match(e[n])||e[n]===n)return n;return i.split("/")[0]||"index"},reset:function(){this.historyList.setHead()},setCurrentNodeByName:function(t){this.curNode=this.historyList.findNodeByName(t),this.curNode||(this.curNode=new i({data:{url:location.href.replace(location.origin,""),name:t},historyList:this.historyList}),this.historyList.setHead(this.curNode))},getCurrentNode:function(){return this.curNode},findNodeByName:function(t){return this.historyList.findNodeByName(t)},saveNodes:function(){this.historyList.saveNodes()},forward:function(t){if(t.replace)this.getCurrentNode().getData().url=t.url;else{var e={url:t.url,name:t.pageName||this.getPageNameByUrl(t.url)},n=new i({data:e,historyList:this.historyList});this.curNode.setNext(n),n.setPreview(this.curNode)}this.historyList.saveNodes()},back:function(){if(this.curNode.equal(this.getDefaultNode()))return this.historyList.setHead(),"";var t=this.curNode.getPreview();return t?t.getData().url:(this.historyList.insertBefore(this.curNode,this.getDefaultNode()),this.historyList.getHead().getData().url)},backToPageName:function(t){var e=this.historyList.findNodeByName(t);return e?e.getData().url:void 0}});return r.getInstance=function(){return this.instance||(this.instance=new this)},r}),define("GPageManager",["require","cCoreInherit","cHybridShell"],function(t){var e=t("cCoreInherit"),i=t("cHybridShell"),n=new e.Class({getCtmCfg:function(){throw new Error("abstract method")},getCtm:function(){throw new Error("abstract method")},getDefaultPath:function(){throw new Error("abstract method")},getHistoryManager:function(){throw new Error("abstract method")},initialize:function(){this.historyManager=this.getHistoryManager()},triggerAppDragAnimation:function(){Lizard.isHybrid&&CtripPage.app_enable_drag_animation(!0)},disableAppDragAnimation:function(){Lizard.isHybrid&&CtripPage.app_enable_drag_animation(!1)},forward:function(t){var e=void 0===t.trigger?!0:t.trigger;this.appendCtm(t),this.historyManager.forward(t),Lizard.isHybrid&&e?this.hybridForward(t):Lizard[t.path&&t.path!==this.getDefaultPath()?"jump":"forward"].call(Lizard,t.url,t.opts)},appendCtm:function(){var t=function(e,i){if("string"==typeof e)return e===i;for(var n in e)if(t(e[n],i))return!0};return function(e){return e.ctm&&e.ctm.key&&(e.url=this.getCtm().buildCtmUrl(e.url,e.ctm.key,e.ctm.id,t(this.getCtmCfg(),e.ctm.key),!!e.ctm.force)),e}}(),hybridForward:function(t){var e=new i.Fn("open_url");e.run(this._buildHybridUrl(t.url,t.path),4,"",t.pageName||"",!1)},setPageName:function(t){if(Lizard.isHybrid){var e=function(){},n=new i.Fn("set_page_name",e);n.run(this._parsePageName(t,1))}this.historyManager.setCurrentNodeByName(this._parsePageName(t))},back:function(t){t=t||{};var e=t.callbackString||"",i=t.isDeleteH5Page||!1,n=this.historyManager.back();if(t.url&&t.url!==n){var r=t.pageName||this.historyManager.getPageNameByUrl(t.url),a=this.historyManager.findNodeByName(r);n=t.url,a&&a.setData(_.extend(a.getData(),{url:n}))}Lizard.isHybrid?("string"!=typeof e&&(e=JSON.stringify(e)),CtripUtil.app_back_to_last_page(e,i)):Lizard.back(n,t.opts)},backToPageName:function(t,e){if(Lizard.isHybrid){this.historyManager.backToPageName(t);var n=new i.Fn("back_to_page",e);n.run(this._parsePageName(t,!0))}else{var t=this._parsePageName(t),r=this.historyManager.backToPageName(t);this.forward({url:r,pageName:t})}},_buildHybridUrl:function(t,e){return(e||this.getDefaultPath())+"/index.html#"+t},_parsePageName:function(t,e,i){return t=t.split("_")[1]||t,e?(i||this.getDefaultPath())+"_"+t:t}});return n.getInstance=function(){return this.instance||(this.instance=new this)},n}),define("GModelConfig",{}),define("GModelFactory",["require","cModel","cCoreInherit","GModelConfig"],function(t){var e=t("cModel"),i=t("cCoreInherit"),n=t("GModelConfig"),r=function(t,n,r){var a=t.propertys||function(){$.extend(this,t),this.param=$.extend({ver:r||window.__apiVersion__},this.param),this.buildurl=function(){return n(this.protocol,this.url)},this.result&&(this.result=this.result.getInstance())};return new i.Class(e,{__propertys__:a,initialize:function($super,t){$super(t)}})};return{createModels:function(t,e,i){t=t||n;var a={};for(var o in t)a[o]=r(t[o],e,i);return a}}}),define("GRouterAdapter",["cUtility","cHybridFacade"],function(t,e){var i={hybridBaseUrl:"ticket/index.html"};return i.forward=function(e){var i=t.isInApp&&e.trigger,n=e.url,r=e.opts,a=e.path;i?this.hybridForward(n,a):Lizard.forward(n,r)},i.triggerAppDragAnimation=function(t){t&&t.ifRegister&&e.register({tagname:e.METHOD_WEB_VEW_DID_APPEAR,callback:function(e){CtripPage.app_enable_drag_animation(!0),t&&t.callback&&t.callback(e)}})},i.disableAppDragAnimation=function(){},i.hybridForward=function(t,i){var n={name:e.METHOD_OPEN_URL,openUrl:this._buildHybridUrl(t,i),targetMode:4};e.request(n)},i.back=function(e){var i=t.isInApp&&e.trigger,n=e.url,r=e.opts,a=e.callbackString||"",o=e.isDeleteH5Page||!1;i?("string"!=typeof a&&(a=JSON.stringify(a)),CtripUtil.app_back_to_last_page(a,o)):Lizard.back(n,r)},i._buildHybridUrl=function(t,e){return e?e+"/"+t:this.hybridBaseUrl+"#"+t},i}),define("GUrlUtil",["cUtility"],function(t){return{parseUrl:function(t){function e(t){var e={};if(!t)return e;if(t.indexOf("=")<0)return e[""+t]="",e;var i=t.match(a);if(!i)return e;for(var n=i.length-1;n>=0;n--){var r=i[n],o=r.split("="),s=o[0],c=o[1];e[s]=decodeURIComponent(c)}return e}function i(){return e(s)}function n(){return e(c)}var r={},a=/([^&]*)=([^&]*)/g,o=/([^#\?]*)/g.exec(t)[1],s=t.indexOf("?")>-1?/\?([^#]*)/g.exec(t)[1]:null,c=t.indexOf("#")>-1?/#([^\?]*)/g.exec(t)[1]:null;return r.param=i,r.hashParam=n,r.scheme=o.indexOf(":")>-1?/^([^:]*):/.exec(o)[1]:null,r},local:function(){return location.href},localPath:function(){var e=location.pathname,i=e.split("/");i[i.length-1]="";var n=i.join("/");return t.isInApp?location.protocol+"//"+location.host+n+"index.html#/":location.protocol+"//"+location.host+n},schema:function(){var t=window.location,e=t.pathname,i=t.search,n=e.split("/"),r="ticket",a="index";if(i.indexOf("?")>=0&&(i=i.substr(i.indexOf("?")+1),i="&"+i),(e.indexOf("/webapp/")>-1||e.indexOf("/html5/")>-1)&&(e=e.replace("/webapp/",""),e=e.replace("/html5/",""),n=e.split("/"),r=n.shift()),""===n[0]&&n.shift(),n.length>0){for(var o=n.length-1;o>=0;o--)n[o]=encodeURIComponent(n[o]);a=n.join("/")}return"/h5?path="+r+"&page=index.html#/"+a+i},HTMLEncode:function(t){var e=document.createElement("div");null!==e.textContent?e.textContent=t:e.innerText=t;var i=e.innerHTML;return e=null,i},HTMLDecode:function(t){var e=document.createElement("DIV");e.innerHTML=t;var i=e.innerText;return e=null,i},json2url:function(t){if(!t)return"";var e=[];for(var i in t)e.push(i+"="+t[i]);return e.join("&")},url2json:function(t){var e={};return t?e=this.parseUrl(t).param():e},geturl2json:function(){return this.url2json(location.href)},setQueryString:function(t,e,i){if("object"==typeof e){for(var n in e)t=this.setQueryString(t,n,e[n]);return t}var r=new RegExp(e+"=([^&]*)"),a=e+"="+i;return t=t||"?",r.test(t)?t=t.replace(r,a):(t.length>1&&(t+="&"),t+=a),t},query2json:function(t){t.indexOf("?")>=0&&(t=t.substring(t.indexOf("?")+1));for(var e=t.split("&"),i=0,n={},r=e.length;r>i;i++){var a=e[i].split("=");n[a[0]]||(n[a[0]]=a[1])}return n},json2query:function(t){if(!t)return"";t=_.clone(t);var e=[],i=[],n=function(e){t[e]&&(this[e]=t[e],delete t[e])};return[t,{},{}].forEach(function(t,i){this[i]&&(i&&("string"==typeof this[i]&&(this[i]=this[i].split(",")),(this[i]||[]).forEach(n.bind(t))),1===i?e.unshift(t):e.push(t))}.bind(arguments)),e.forEach(function(t){for(var e in t)t[e]&&i.push(e+"="+t[e])}),i.join("&")},getSearch:function(t){if(t||Lizard.isHybrid){t=decodeURIComponent(window.location.hash||t);var e=(t.split("?")||[]).slice(1).join("?");return e?"?"+e:""}return location.search},getPathName:function(){if(!t.isInApp)return location.pathname;var e=decodeURIComponent(window.location.hash);return(e.split("?")[0]||"").replace("#","")},parseCommas:function(t){for(var e,i=t.replace(/^\s+|\s+$/g,"").replace(/\s+/g," ").split(",");i.length&&(e=i.pop(),""===e||" "===e););return e||""}}}),define("GView",["require","cPageView","cUtility","GRouterAdapter","GController","GLogger","GUrlUtil","cGuider"],function(t){var e=t("cPageView"),i=t("cUtility"),n=t("GRouterAdapter"),r=t("GController"),a=t("GLogger"),o=t("GUrlUtil"),s=t("cGuider"),c=e.extend({hasAd:!0,isInApp:i.isInApp,guider:s,controller:r.getInstance(),routerAdapter:n,events:{},getAppUrl:function(){return o.schema()},onCreate:function(t){this.createPageId(),this.notificationMap={},this.initLog(t)},initLog:function(t){this.logger={name:this.name};var e=a.getInstance(t);["info","log","warn","error"].forEach(function(t){this.logger[t]=function(){var i=[].slice.call(arguments),n=i.shift();e[t].call(e,n,i,this.name)}},this)},createPageId:function(){},onShow:function(){for(var t in this.notificationMap)this.controller.addNotificationListener(t,this.notificationMap[t])},onHide:function(){for(var t in this.notificationMap)this.controller.removeAllGatesByName(t);this.hideWarning404()},_showToast:function(t,e,i,n){this.showToast(t,e||3,i,n)},_showLoading:function(){this.showLoading()}});return c}),define("GBulkLazyLoad",["libs","cCoreInherit"],function(t,e){var i=new e.Class({__propertys__:function(){this.indexes=[],this.images=[],this.onScroll=$.proxy(function(){this._lazyLoad()},this),this.config={scrollContainer:window,container:"body",selector:"",type:"",attrName:"imglazyload-src",diff:0,autoProxy:!1,isAutoLazyLoad:!0,loadingCss:"cui-item-imgbg",fadeInClass:"fade-in"}
},initialize:function($super,t){this.setOptions(t),this.config.isAutoLazyLoad&&$(this.config.scrollContainer).bind("resize scroll",this.onScroll),this._NO_IMG_CODE=t.NO_IMG_CODE,this._LOAD_IMG_CODE=t.LOAD_IMG_CODE,this._ERROR_IMG_CODE=t.ERROR_IMG_CODE,this.onStart=t.onStart,this.onError=t.onError,this.onComplete=t.onComplete},setOptions:function(t){var e=this;$.extend(this.config,t||{}),this.$container="string"==typeof this.config.container?$(this.config.container):this.config.container,this.config.autoProxy&&this.$container.find("img").each(function(t,i){$(i).attr(e.config.attrName,i.src),$(i).removeAttr("src")})},destroy:function(){delete this.indexes,$(this.config.scrollContainer).unbind("resize scroll",this.onScroll),this.$container.find("img."+this.config.fadeInClass).removeClass(this.config.fadeInClass)},load:function(t){var e=this.indexes.some(function(e){return e===t});e||("undefined"!=typeof t&&this.indexes.push(t),this.index=t,this._lazyLoad())},_getImages:function(){var t,e=this.index||0;switch(this.config.type){case i.TYPE.WATERFALL:t=this.$container.find(this.config.selector+":nth-of-type(n+"+e+") img["+this.config.attrName+"]");break;case i.TYPE.CAROUSE:case i.TYPE.TAB:t=this.$container.find(this.config.selector+" img").eq(e).filter("["+this.config.attrName+"]");break;default:t=this.$container.find(this.config.selector+" img["+this.config.attrName+"]")}return t},_lazyLoad:function(){this.images=this._getImages(),this.images&&(this.images.each($.proxy(function(t,e){var i=$(e).offset().top,n=$(window).height()+$(window).scrollTop()+this.config.diff;n>i&&this._loadImage($(e))},this)),$(this.config.scrollContainer).unbind("resize scroll",this.onScroll),this.images.length&&$(this.config.scrollContainer).bind("resize scroll",this.onScroll))},_loadImage:function(t){var e=this,i=function(){t.attr("src",a).removeAttr(e.config.attrName),t.addClass(e.config.fadeInClass),t.removeClass(e.config.loadingCss),"function"==typeof e.onComplete&&e.onComplete.call(t)},n=function(){e._ERROR_IMG_CODE&&t.attr("src",e._ERROR_IMG_CODE).removeAttr(e.config.attrName),"function"==typeof e.onError&&e.onError.call(t)},r=$(new Image),a=t.attr(this.config.attrName);return a?(this._LOAD_IMG_CODE&&t.addClass(this.config.loadingCss).attr("src",this._LOAD_IMG_CODE),"function"==typeof this.onStart&&this.onStart.call(this,this),void r.bind("error",n).bind("load",i).attr("src",a)):void n()}});return i.TYPE={WATERFALL:"waterfall",CAROUSE:"carouse",TAB:"tab"},i}),define("GFormat",{formatTitle:function(t,e){var i,n;if(i=/[^\x00-\xff]/g,n=Math.floor(e/2),t.replace(i,"mm").length<=e)return t;for(var r=n;r<t.length;r++)if(t.substr(0,r).replace(i,"mm").length>=e)return t.substr(0,r)+"...";return t},substring:function(){this.formatTitle.apply(this.arguments)},getStringLength:function(t){var e=/[^\x00-\xff]/g;return t.replace(e,"mm").length},isToday:function(t){var e=new Date(t),i=new Date;return e.getFullYear()===i.getFullYear()&&e.getMonth()===i.getMonth()&&e.getDate()===i.getDate()},formatDistance:function(t){var e="";return e=.1>t?"小于100米":1>t?Math.round(1e3*t)+"米":100>t?Math.round(10*t)/10+"公里":300>t?Math.round(t)+"公里":"大于300公里"},getDistanceByLngLat:function(){return function(t,e,i,n){return 110*Math.sqrt(Math.pow(t-i,2)+Math.pow(e-n,2))}}(),listFloor:function(t,e,i){if(!t||!t.length)return[];i&&(t=t.slice(0,e*i));var n=t.length%e,r=t.length-n;return t.slice(0,r)}}),define("GTraceLog",["cUtility","GUrlUtil","cCoreInherit"],function(t,e,i){var n=new i.Class({__propertys__:function(){},initialize:function(){},getKey:function(){},createPageId:function(){},log:function(i,n,r){if(this.createPageId(n),n.source||(n.source=t.isInApp?"app":"h5"),window.__bfi=window.__bfi||[],r=this.getKey(r),i){var a=i.match(/\$\{[^&]*\}/gi);a&&a.forEach(function(t){var e=t.replace(/\$\{(\S+)\}/,"$1");i=i.replace(t,encodeURIComponent(void 0===n[e]?"":n[e]))});var o=e.query2json(i);for(var s in o)void 0!==n[s]&&""===o[s]&&(o[s]=encodeURIComponent(n[s]));i=e.json2url(o)}else{for(var c in n)n[c]=encodeURIComponent(n[c]);i=e.json2url(n)}return window.__bfi.push(["_tracklog",r,i]),i}});return n.getInstance=function(){return this.instance||(this.instance=new this)},n}),define("GScrollDrag",[],function(){function t(t){this.bodyEl=$("body"),this.boxEl=t.boxEl||this.bodyEl,this.scrollDragEl=t.scrollDragEl||$(".js_scroll-box ",this.boxEl),this.iosFixed=t.iosFixed||!0,this.boxOffset=t.boxOffset,this.scrollOffset=t.scrollOffset||t.boxOffset,this.scrollCallBack=t.scrollCallBack||function(){},this.init()}return t.prototype={init:function(){var t=document.documentElement.clientHeight,e=0,i=0;this.boxOffset&&(e=Lizard.isHybrid?this.boxOffset.hi:this.boxOffset.h5),this.scrollOffset&&(i=Lizard.isHybrid?this.scrollOffset.hi:this.scrollOffset.h5),this.boxEl.height(t-e),this.boxEl.addClass("entable-scroll-drag-box"),this.scrollDragEl.height(t-i),this.scrollDragEl.addClass("entable-scroll-drag"),this.bindEvents()},clear:function(){this.boxEl.removeClass("entable-scroll-drag"),this.boxEl.height("auto"),this.boxEl.removeClass("entable-scroll-drag-box"),this.scrollDragEl.height("auto"),this.scrollDragEl.removeClass("entable-scroll-drag"),this.scrollDragEl.unbind("scroll")},bindEvents:function(){var t=this;this.scrollDragEl.bind("scroll",function(e){t.scrollCallBack&&t.scrollCallBack(e)})}},t}),define("GSearch",["cCoreInherit","cUtility","GUrlUtil","GFormat","cUIInputClear"],function(t,e,i,n,r){"use strict";var a,o,s=!1,c=function(){var t;return{set:function(e,i,n,r){this.clear(),t=setTimeout(function(){i.apply(e,r)},n)},clear:function(){t&&clearTimeout(t)}}}(),l=4,d=new t.Class({__propertys__:function(){},getCommand:function(){return{excute:function(){return"getCommand is an abstract method, please override it and return command instance!"}}},initialize:function(t){this.placeholder=t.placeholder||"景点名称/游玩主题",this.keyword=t.keyword,this.searchButtonText=t.searchButtonText,this.searchHistoryStore=t.searchHistoryStore,this.searchModel=t.searchModel,this.resultRenderer=t.resultRenderer||this._resultRenderer,this.historyRenderer=t.historyRenderer||this._historyRenderer,this.themeRenderer=t.themeRenderer||this._themeRenderer,this.returnHandler=t.returnHandler,this.focusCallback=t.focusCallback,this.blurCallback=t.blurCallback,this.resultItemCallback=t.resultItemCallback,this.themeItemCallback=t.themeItemCallback,this.searchCallback=t.searchCallback,this.form=t.form,this.section=t.section,this.parent=t.parent,this.isShowEmpty=void 0===t.isShowEmpty?!1:t.isShowEmpty,this.isShowBackButton=!!t.isShowBackButton,this.isShowSearchButton=!!t.isShowSearchButton,this.isShowHistory=!!t.isShowHistory,this.createLayout(),this.buildEvent(),this._renderHistoryList(),this._showHistory(),this.isShowHistory&&this.section.show(),t.autoFocus?this._onFocus():this.els.searchInput.blur()},setTheme:function(t){this._renderThemeList(t)},setResult:function(t){this._list=t,this._renderResultList(t)},getResult:function(){return this._list},getValue:function(){return this.els.searchInput.val().trim()},getInput:function(){return this.els.searchInput},getSearchWrapHeight:function(){return this.els.searchWrap.height()},createLayout:function(){this.parent&&(this.section||(this.section=$(u),this.form?this.parent.insertAfter(this.section):this.parent.prepend(this.section)),this.form||(this.form=$(h),this.parent.prepend(this.form))),this.els={searchWrap:this.form.find("#searchWrap"),searchBack:this.form.find("#searchBack"),searchInput:this.form.find("#searchInput"),searchButton:this.form.find("#searchButton"),loadingIcon:this.form.find(".cui-pro-load"),themeContainer:this.section.find("#themeContainer").hide(),themeList:this.section.find("#themeContainer"),resultContainer:this.section.find("#resultContainer").hide(),resultList:this.section.find("#resultList"),notResult:this.section.find("#notResult"),historyContainer:this.section.find("#historyContainer").hide(),historyList:this.section.find("#historyList"),clearHistoryButton:this.section.find("#clearHistoryButton"),commandLine:this.section.find("#command")},this.searchButtonText&&this.els.searchButton.text(this.searchButtonText),this.els.commandLine&&this.els.commandLine.css({height:window.innerHeight-this.els.searchWrap.height()+"px",position:"absolute",top:s?"54px":"44px"}),r(this.els.searchInput,null,null,{top:14,right:-4},!0),this.els.searchInput.attr("placeholder",this.placeholder),this.els.searchInput.val(this.keyword),this.isShowBackButton?this.els.searchBack.show():(this.els.searchBack.hide(),this.els.searchWrap.css({"padding-left":"15px"})),this.isShowSearchButton?this.els.searchButton.show():this.els.searchButton.hide(),e.isInApp&&s&&this.els.searchWrap.css("padding-top","24px")},buildEvent:function(){this.els.searchBack.bind("click",$.proxy(this._backAction,this)),this.els.searchInput.bind("input",$.proxy(this._keywordInput,this)),this.els.searchInput.blur(),this.els.searchInput.bind("click",$.proxy(this._onFocus,this)),this.els.searchButton.bind("click",$.proxy(this._searchAction,this)),this.form.bind("submit",function(t){return t.preventDefault(),this.els.searchInput.blur(),!1}.bind(this)),this.els.historyList.delegate("li","click",$.proxy(this._itemAction,this)),this.els.clearHistoryButton.bind("click",$.proxy(this._clearHistoryAction,this)),this.els.resultList.delegate("li","click",$.proxy(this._itemAction,this)),this.els.themeList.delegate("li","click",$.proxy(this._themeAction,this)),this.els.commandLine.size()&&(this.onKeyUp=$.proxy(this._keyUpHandler,this)),this.onTouchStart=$.proxy(this._touchStart,this),this.onTouchMove=$.proxy(this._touchMove,this),$("body").bind("touchstart",this.onTouchStart).bind("touchmove",this.onTouchMove),this.els.commandLine.size()&&$(window).bind("keyup",this.onKeyUp)},destroy:function(){this.history=[],this.historyIndex=0,this.els.searchInput.blur(),$("body").unbind("touchstart",this.onTouchStart).unbind("touchmove",this.onTouchMove),this.els.commandLine.size()&&$(window).unbind("keyup",this.onKeyUp),this.searchModel&&this.searchModel.abort(),this.section.remove(),this.form.remove()},_onFocus:function(){this.isShowBackButton?(this.els.searchButton.show(),this.section.show()):this.els.searchInput.val()&&this.section.show(),this.els.searchInput.focus(),this.focusCallback&&this.focusCallback(),this._keywordInput()},_onBlur:function(){this.els.searchButton.hide(),this.section.hide(),this.blurCallback&&this.blurCallback()},_itemAction:function(t){t.preventDefault();var e={id:parseInt(t.currentTarget.dataset.id),name:t.currentTarget.dataset.name,type:parseInt(t.currentTarget.dataset.type),pname:t.currentTarget.dataset.pname},i=$(t.currentTarget).index(),n="historyList"===t.currentTarget.parentNode.id;this.searchHistoryStore&&(this.searchHistoryStore.add(e),this._renderHistoryList()),this.resultItemCallback(e,i,n)},_backAction:function(){this.els.searchButton.hide(),this.section.hide(),this.returnHandler&&this.returnHandler()},_themeAction:function(t){var e=t.target.innerText;this.themeItemCallback(e,$(t.currentTarget).index())},_searchAction:function(t){if(t.preventDefault(),!this.isShowHistory)return void(this.returnHandler&&this.returnHandler());var e=$.trim(this.els.searchInput.val());e&&(this.execute(e)||(this.searchHistoryStore&&this.searchHistoryStore.add&&(this.searchHistoryStore.add({name:e}),this._renderHistoryList()),this.searchCallback&&this.searchCallback(e)))},_keywordInput:function(){var t=$.trim(this.els.searchInput.val());""!==t?(this.els.loadingIcon.show(),c.set(this,this._queryKeyWord,300,[t]),this.els.searchButton.removeClass("search_disable"),this.els.historyContainer.hide(),this.els.themeContainer&&this.els.themeContainer.hide()):(c.clear(),this._queryKeyWord(""),this.els.loadingIcon.hide(),this.els.searchButton.addClass("search_disable"),this.els.resultContainer.hide(),this._showHistory(),this.els.themeContainer&&this.els.themeContainer.show())},_showHistory:function(){this.els.historyList.children().size()?this.els.historyContainer.show():this.els.historyContainer.hide()},_queryKeyWord:function(){var t=function(t){this.els.loadingIcon.hide();var e=t.data?t.data.acitems:[];this._renderResultList(e)},e=function(){this.els.loadingIcon.hide()};return function(i){this.isShowHistory||(""!==i?this.section.show():this.section.hide()),this.searchModel&&i&&(this.searchModel.setParam("keyword",i),this.searchModel.excute(t,e,!0,this)),!this.searchModel&&this.searchCallback&&(this.els.loadingIcon.hide(),this.searchCallback(i))}}(),_renderThemeList:function(t){!!t.length&&this.els.themeList.html(this.themeRenderer({data:t}))},_renderResultList:function(t){this.els.resultList.html(this.resultRenderer({data:t})),this.els.resultContainer.show(),t.length?(this.els.resultList.show(),this.els.notResult.hide()):(this.els.resultList.hide(),this.isShowEmpty?this.els.notResult.show():this.els.notResult.hide())},_renderHistoryList:function(){if(this.searchHistoryStore){var t=this.searchHistoryStore.get().list||[];t.forEach(function(t){t.name=i.HTMLEncode(t.name)}),this.els.historyList.html(this.historyRenderer({data:t}))}},_clearHistoryAction:function(){this.searchHistoryStore&&this.searchHistoryStore.remove(),this._renderHistoryList(),this.els.historyContainer.hide()},_resultRenderer:function(t){var e=[];return t.data.forEach(function(t){var i=parseInt(t.type),n='<li data-id="'+(t.id||"")+'" data-type="'+(t.type||"")+'" data-name="'+(t.name||"")+'" data-pname="'+(t.pname||"")+'">';n+=t.name,3===i?n+="景点门票":5===i?n+="当地玩乐":4===i&&t.pname&&(n+="，"+t.pname),t.vtag&&(n+='<span class="ticket_searchprolist_type">（'+t.vtag+"）</span>"),n+="</li>",e.push(n)}),e.join("")},_historyRenderer:function(t){return this._resultRenderer(t)},_themeRenderer:function(t){var e=t.data||[];e=n.listFloor(e,l,2);var i=[];return e.forEach(function(t){var e=n.getStringLength(t)>=10?"f13":"";i.push('<li class="fl tc bgwh"><span class="dib lh18 '+e+'">'+t+"</span></li>")}),i.join("")},_touchStart:function(t){var e=t.touches[0];a=e.pageX,o=e.pageY},_touchMove:function(t){var e=t.touches[0];Math.abs(e.pageY-o)>=10&&this.els.searchInput.blur()},history:[],historyIndex:0,_keyUpHandler:function(t){this.els.commandLine.size()&&""===this.els.commandLine[0].style.display&&(38===t.keyCode||40===t.keyCode)&&(38===t.keyCode?this.historyIndex>0&&this.historyIndex--:40===t.keyCode&&this.historyIndex<this.history.length-1&&this.historyIndex++,this.els.searchInput.val(this.history[this.historyIndex]))},argParse:function(t){var e=this.els.commandLine.text(),i=this.getCommand().execute(t);this.history.push(t),this.historyIndex=this.history.length-1,i&&this.els.commandLine.html(e?e+"\n"+i:i),this.els.commandLine[0].scrollTop=this.els.commandLine[0].scrollHeight},execute:function(t){if(this.els.commandLine.size()){var e=["qa foo","qa bar","c","cls"],i=e.some(function(e){return e===t});switch(t=t.toLowerCase()){case e[0]:this.els.commandLine.show();break;case e[1]:this.els.commandLine.hide();break;case e[2]:case e[3]:""===this.els.commandLine[0].style.display&&this.els.commandLine.text("")}return i?(this.els.searchInput.val(""),!0):""===this.els.commandLine[0].style.display?(this.els.searchInput.val(""),this.argParse(t),!0):void 0}}}),h='<form onsubmit="return false"><div class="search_wrap flex_container" id="searchWrap">	<a class="back rel fl" id="searchBack"></a>	<div class="search_box search_box2 flex_box">		<input type="search" class="search_input search_input2 abs_size nofastclick" placeholder="景点名称/游玩主题" id="searchInput" maxlength="100">		<span class="cui-pro-load" style="display:none">			<span class="cui-pro-radius"></span>			<span class="cui-i cui-pro-logo"></span>		</span>	</div>	<button id="searchButton" class="cui-btn-cancle search_cancel search_cancel2 search_disable mr-15">搜索</button></div></form>',u='<section style="display:none;"><ul class="general_search overflow f15" id="themeContainer"></ul><div id="resultContainer">	<ul class="ticket_searchprolist bgwh" id="resultList"></ul>	<ul class="cui-city-itmes" id="notResult">		<li>			<ul class="cui-city-n"><p class="cui-city-novalue">没有结果</p></ul>		</li>	</ul></div><div id="historyContainer">	<ul class="ticket_searchprolist bgwh" id="historyList"></ul>	<button type="button" class="cui-btn-history-2" id="clearHistoryButton">清除搜索历史</button></div> <textarea style="background:#000;color:red;border:0;width:100%;vertical-align:top;display:none;" id="command">welcome</textarea></section>';return d}),define("TicketCityStoreConfig",{GeoLocationStore:{key:"POSITION_CITY"},TicketGeoLocationStore:{key:"U_TICKET_GEOLOCATION",lifeTime:"10M",setPosInfo:function(t){for(var e in t)this.setAttr(e,t[e])}},TicketSelectedCityStore:{key:"U_TICKET_SELECTED_CITY",lifeTime:"30D",setCityInfo:function(t){for(var e in t)this.setAttr(e,t[e])}},TicketLastGeoCityStore:{key:"U_TICKET_LASTGEOCITY",lifeTime:"1D",setCityInfo:function(t){for(var e in t)this.setAttr(e,t[e])}},TicketGeoCityStore:{key:"U_TICKET_GEOCITY",lifeTime:"10M",setCityInfo:function(t){for(var e in t)this.setAttr(e,t[e])}}}),define("listConst",{List_PAGE_TYPE:{KEYWORD:1,NEARBY:2,CITY:3,THEME:4},LIST_SORT_TYPE:{DEFAULT:1,PRICE_ASCENDING:2,PRICE_DESCENDING:3,SCORE:4,LEVEL:5,DISTANCE:6},LIST_NOTIFICATION:{ACTIVITY_RECOMMEND_READY:"ACTIVITY_RECOMMEND_READY",TICKET_RECOMMEND_READY:"TICKET_RECOMMEND_READY",TICKET_NO_MORE_SHOWED:"TICKET_NO_MORE_SHOWED"},LIST_PSIZE:20}),define("TicketStoreConfig",["require","listConst"],function(t){var e=t("listConst");return{CustomerInfoTemplateStore:{key:"P_TICKET_PASSENGERTEMPLATE",lifeTime:"1H"},PassengerTemplateParam:{defaultData:{rids:[]},key:"P_TICKET_PASSENGERTEMPLATE_PARAM",lifeTime:"1H"},PassengerTempStore:{key:"U_TICKET_PASSENGER_TEMP",lifeTime:"360D"},PassengerStore:{defaultData:{passengers:[]},key:"U_TICKET_PASSENGER_STORE",lifeTime:"1H"},TicketHPBannerListStore:{key:"P_TICKET_HPBANANER",lifeTime:"10M"},TicketSpecialBannerListStore:{key:"P_TICKET_BANANER",lifeTime:"10M"},TicketRecommendActivityStore:{key:"P_TICKET_RECOMMEND_ACTIVITY",lifeTime:"1H"},TicketRecommendViewSpotStore:{key:"P_TICKET_RECOMMEND_VIEWSPOT",lifeTime:"1H"},TicketHPSHXBottomImageStore:{key:"P_TICKET_HPSHX",lifeTime:"1H"},TicketHPCategoryListStore:{key:"P_TICKET_HPCATEGORYLIST",lifeTime:"1H"},TicketCityListStore:{key:"P_TICKET_CITYLIST",lifeTime:"1D"},TicketCityRecommendListStore:{key:"P_TICKET_RECOMMEND_CITYLIST",lifeTime:"1D"},TicketHistoryCityStore:{defaultData:{inter:[],inland:[],tab:0},key:"U_TICKET_HISTORY_CITY",lifeTime:"15D"},TicketSearchStore:{defaultData:{facets:[],viewspots:[],total:0,totalpage:0},key:"P_TICKET_TICKETSEARCH_LIST",lifeTime:"1D"},TicketListParamStore:{defaultData:{keyword:"",lon:null,lat:null,radiusmin:null,radiusmax:null,themeids:"",pcategorys:"",distids:"",paymode:"",isnowuse:null,sort:1,pidx:1,psize:e.LIST_PSIZE,isneedf:1,from:""},key:"S_TICKET_LIST_PARAM",lifeTime:"30D",getAll:function(){var t=this.get();return{keyword:t.keyword,lon:t.lon,lat:t.lat,radiusmin:t.radiusmin,radiusmax:t.radiusmax,themeids:t.themeids,distids:t.distids||"",paymode:t.paymode||null,isnowuse:t.isnowuse||null,sort:t.sort,pidx:t.pidx,psize:t.psize,isneedf:t.isneedf,scname:t.scname||"",smode:t.smode||0}}},TicketListResultStore:{defaultData:{rids:[]},key:"P_TICKET_LIST_RESULT",lifeTime:"1H"},CustomerVacationTicketDetailStore:{defaultData:{rids:[]},key:"O_TICKET_CUSTOMER_VACATION_TICKET_DETAIL",lifeTime:"1H",isUserData:!0},TicketListFacetsStore:{key:"P_TICKET_LIST_FACETS",lifeTime:"1H"},TicketListStore:{key:"P_TICKET_LIST",lifeTime:"5M"},TicketListRecommendStore:{key:"P_TICKET_LIST_RECOMMEND",lifeTime:"5M"},TicketListFilterStore:{key:"U_TICKET_LIST_FILTER_PARAM",lifeTime:"3H"},TicketDetailParamStore:{defaultData:{id:"",pagetype:""},key:"S_TICKET_TICKETDETAIL_PARAM",lifeTime:"1D"},TicketWeatherStore:{key:"P_TICKET_WEATHER",lifeTime:"10M"},TicketDetailStore:{key:"P_TICKET_TICKETDETAIL",lifeTime:"1D"},TicketScoreResultStore:{key:"P_TICKET_TICKETDETAIL_SCORE",lifeTime:"10M"},TicketSearchHistoryStore:{defaultData:{list:[]},key:"U_TICKET_TICKETSEARCH_HISTORY",lifeTime:"30D",add:function(t){"undefined"==typeof t.type&&this.setAttr("keyoword",t.name);var e=this.get(),i=e.list,n=[];i.forEach(function(e){e.name!==t.name&&n.push(e)}),n=[t].concat(n),this.setAttr("list",n.splice(0,5))},getKeyword:function(){return this.getAttr("keyoword")}},TicketBookingParamStore:{defaultData:{tickets:[]},key:"S_TICKET_BOOKING_PARAM",lifeTime:"2H"},TicketURLParamStore:{key:"S_TICKET_URL_PARAM",lifeTime:"1D",getParam:function(){var t=[].slice.call(arguments,0),e=this.getAttr("query")||{},i={};switch(t.length){case 0:return e;case 1:return e[t[0]];default:t.forEach(function(t){i[t]=e[t]})}return i}},TicketGlobalParamStore:{key:"S_TICKET_GLOBAL_PARAM",lifeTime:"1D",defaultData:{}},AllianceExtend:{defaultData:{},key:"P_TICKET_ALLIANCE",lifeTime:"1D"},TicketHistory:{key:"P_TICKET_HISTORY",lifeTime:"10M"}}}),define("TicketAbstractStore",["cCoreInherit","cStore"],function(t,e){var i=function(t){var e,i,n=t,t=t.replace(/([^\|]*)(?:\|.*)?$/gim,"$1"),r=/^([^?&|]*)(.*)?$/i.exec(t),a=r[1]?r[1].split("!"):[],o=(a.shift()||"").replace(/(^\/+|\/+$)/i,""),s=a.length?a.join("!").replace(/(^\/+|\/+$)/i,"").split("/"):{},c=(r[2]||"").replace(/^\?*/i,"").split(/[&-]/),l={};if(c)for(var d=0;d<c.length;d++)c[d]&&(e=c[d].split(/[=_]/),e[1]?(i=e.shift(),l[i]=e.join("=")):l[e[0]]="");return{viewpath:o,path:s,query:l,root:location.pathname+location.search,fullhash:n}},n=new t.Class(e,{setURLParamsToStore:function(){function t(t){var e=0;for(var i in t)"undefined"!=typeof t[i]&&null!==t[i]&&e++;return e}function e(t){if(t+="",t.length<1||t.indexOf(",")<0)return t;for(var e=t.split(","),i=e.length-1;i>=0;i--){var n=""+e[i];if(n.length>0)return n}return""}var i,n=[].slice.call(arguments),r=n.length,a=this;r>0&&"function"==typeof n[r-1]&&(i=n.pop());var o=a.getURLParams.apply(a,n);if("string"==typeof o&&(o=[o]),"function"==typeof i){var s=[];$.each(o,function(t,e){s.push(e)}),i.apply(a,s)}else{var r=t(o);if(r>0){var c=a.defaultData;c&&$.each(c,function(t,e){a.setAttr(t,e)}),$.each(o,function(t,i){void 0!=i&&(i=e(i),a.setAttr(t,i))})}}return o},getURLParams:function(){var t=window.location.hash.replace(/^#+/i,""),e=i(t),n=(e.query||{},[].slice.call(arguments)),r={};return n.forEach(function(t){r[t]=Lizard.P(t)}),r},setData:function(t){for(var e in t)this.setAttr(e,t[e])}});return n}),define("TicketStore",["GStoreFactory","TicketCityStoreConfig","TicketStoreConfig","TicketAbstractStore"],function(t,e,i,n){var r=t.createStores(e,n),a=t.createStores(i,n);return $.extend(r,a)}),define("TicketConfig",["GRuntimeService","cUtilHybrid"],function(t,e){var i=function(){if(!$.os.ios||!$.os.version)return!1;var t=$.os.version.split(".")[0];return parseInt(t)>=7},n=function(t,e){return"https"===t?Lizard.restfullApiHttps+e:Lizard.restfullApi+e},r=function(t){if(Lizard.isHybrid)return!1;var e=__h5config__&&__h5config__.SitePageSettingItem;if(e&&window.localStorage?(localStorage.removeItem("U_TICKET_H5CONFIG"),localStorage.setItem("U_TICKET_H5CONFIG",JSON.stringify(e))):window.localStorage&&(e=JSON.parse(localStorage.getItem("U_TICKET_H5CONFIG"))),!e)return!1;for(var i=0;i<e.length;i++)if(e[i].ConfigKey==t)return e[i].ConfigValue;return!1},a={indexBack:!0,indexMenu:!0,favorite:!0,login:!0,payment:""};Lizard.isHybrid||(a={indexBack:"1"!=r("Ticket_IsBackButtonHidden"),indexMenu:"1"!=r("Ticket_IsRightBarHidden"),favorite:"1"!=r("Ticket_IsFavoriteHidden"),login:"1"!=r("Ticket_IsBookingLoginHidden"),payment:r("Ticket_payment")});var o={logServerIP:"",logServerPort:"",logAble:!1,consoleAble:!0,guiderPrintAble:!1,defaultCityInfo:{id:2,name:"上海"},posDuration:10,alertAble:!0,isShowBanner:!e.isPro,isNotYouthApp:!e.isYounth,isIOS:!!$.os.ios,isIOS7Plus:i(),busType:7,businessCode:"Order_Vacation_Ticket",runTime:-1,buildVersion:window.__buildVersion__,apiVersion:window.__apiVersion__,getRestfulApi:n,scrollManager:!!$.os.ios&&Lizard.isHybrid,h5:a};return 3!==t.getRunTime()&&(o.logServerIP="10.38.124.223",o.logServerPort="5389"),o}),define("TicketModel",["require","TicketStore","TicketConfig","GModelFactory","GFormat"],function(t){var e=t("TicketStore"),i=t("TicketConfig"),n=t("GModelFactory"),r=t("GFormat"),a={TicketHPBannerListModel:{url:"HPBannerListQOC",dataformat:function(t){var e=t.data;return e.bainfos.forEach(function(t){t.src=t.bsrc,t.link=t.blink+(t.blink.indexOf("?")>-1?"&":"?")+"target=ticket",t.positionId=t.amid,t.adId=function(t){var e=t.match(/^http:\/\/\S+\?a=(\w+)&s=\w+$/);return e?e[1]:0}(t.trkurl)}),e},result:e.TicketHPBannerListStore},TicketSpecialBannerListModel:{url:"SpecialBannerListQOC",param:{limit:10,type:2},dataformat:function(t){var e=t.data;return r.listFloor(e.themes,4),e.bainfos.forEach(function(t){t.src=t.bsrc,t.link=t.blink}),e.nsps=r.listFloor(e.nsps,4),e.botinfo&&(e.botinfo.siinfos=r.listFloor(e.botinfo.siinfos,3),e.botinfo.binfo=e.botinfo.binfo||[]),e},result:e.TicketSpecialBannerListStore},TicketRecommendActivityModel:{result:e.TicketRecommendActivityStore,url:"RecommendActivityListQOC",param:{limit:10,cid:0,size:"C_280_158"},dataformat:function(t){return t.ActivityRecommandList||[]}},TicketRecommendViewSpotModel:{result:e.TicketRecommendViewSpotStore,url:"RecommendViewSpotListQOC",param:{limit:10,cityid:0,size:"C_280_158"},dataformat:function(t){var e=t.data.viewspots||[];return e}},TicketHPSHXBottomImageModel:{result:e.TicketHPSHXBottomImageStore,url:"HPSHXBottomImageQOC",dataformat:function(t){return t.data.shxbimgs}},TicketHPCategoryListModel:{result:e.TicketHPCategoryListStore,url:"HPCategoryListQOC",param:{limit:4,smode:1},dataformat:function(){var t=function(t,e){var i=Math.min(e,t.length);return t.slice(0,i>>1<<1)};return function(e){return e.data.acs=t(e.data.acs||[],4),e.data.ttms=(e.data.ttms||[]).slice(0,4),e.data}}()},TicketCityListModel:{url:"AvailableCityListQOC",param:{limit:1e4},result:e.TicketCityListStore,dataformat:function(){var t=function(t,e){return e.weight-t.weight},e=function(t,e){return!t[e]&&(t[e]=[]),t[e]},i=function(t,i,n){t.ishot&&n.push(t);var r=t.fistchar.toUpperCase();e(i,r).push(t),58===t.id&&e(i,"H").unshift(t),59===t.id&&e(i,"M").unshift(t)};return function(e){for(var n={},r=[],a={},o=[],s={},c=e.data?e.data.cities:[],l=0,d=c.length;d>l;l++)c[l].isdomestic?(i(c[l],n,r),(58===c[l].id||59===c[l].id||617===c[l].id)&&i(c[l],a,o)):i(c[l],a,o),s[c[l].name]=c[l];return{citymap:s,inland:n,inlandhot:r.sort(t),inter:a,interhot:o.sort(t)}}}()},TicketCityRecommendListModel:{url:"CityRecommendListQOC",result:e.TicketCityRecommendListStore},TicketSearchModel:{url:"AutoCompleteSearchQOC",param:{limit:15}},TicketListFacetsModel:{result:e.TicketListFacetsStore,url:"ViewSpotSearchQOC"},TicketListModel:{result:e.TicketListStore,url:"ViewSpotSearchQOC"},TicketListRecommendModel:{result:e.TicketListRecommendStore,url:"ViewSpotSearchQOC",dataformat:function(t){return t.data||{}}},TicketRecommendYouListModel:{url:"RecommendYouListQOC",dataformat:function(t){return t.YouRecommandList||[]}},OrderInsuranceInfoModel:{protocol:"https",url:"OrderInsuranceInfoQOC"},VacationTicketDetailModel:{protocol:"https",result:e.CustomerVacationTicketDetailStore,url:"OrderDetailSearchQOC",param:{ext:"",flag:"1",oid:"900006176"},method:"POST",isUserData:!0},VacationOrderCancelModel:{protocol:"https",debug:!1,url:"OrderManagementQOC",method:"POST",param:{biztype:7,ext:"",flag:0,oid:600824795,reason:"行程不确定"},isUserData:!0},TicketDeModel:{url:"ViewSpotInfoQOC",param:{},result:e.TicketDetailStore},TicketViewSuggest:{url:"ViewSpotSuggestQOC"},TicketCommentsModel:{url:"TicketCommentListQOC"},TicketAttractionsModel:{url:"ViewSpotDescriptionQOC"},TicketPriceListSearchModel:{protocol:"https",url:"TicketPriceListQOC",param:{}},CreateTicketOrderModel:{protocol:"https",url:"CreateTicketOrderQOC",param:{}},UserInfoListSearchModel:{protocol:"https",url:"UserInfoListQOC",param:{uuid:0},result:e.PassengerStore,isUserData:!0},CustomerInfoTemplateSearchModel:{url:"CustomerInfoTemplateQOC",result:e.CustomerInfoTemplateStore},CouponSearchModel:{protocol:"https",url:"CouponSearchQOC"},CouponSearchModelV2:{protocol:"https",url:"CouponSearchV2QOC"},CouponValidationModel:{protocol:"https",url:"CouponValidationQOC"},SHXProductListSearchV2Model:{url:"SHXProductListSearchV2QOC"},ViewSpotImages:{url:"ViewSpotImages"},ResourceInfoModel:{url:"ResourceInfoQOC"},ActivitySearch4List:{url:"ActivitySearchV2QOC"},ActivitySearch:{url:"ActivitySearchV2QOC"},WeatherReal:{url:"WeatherRealQOC"},WeatherForecast:{url:"WeatherForecastQOC"},TravelerModel:{protocol:"https",url:"UserManagementQOC"},SendMessageModel:{url:"SendMessageQOC"},GSLocationModel:{url:"GSLocation"},SubmitCommentModel:{protocol:"https",url:"SubmitCommentCOC"},HotelSearchModel:{url:"HotelSearchQOC"},ApplyCashModel:{protocol:"https",url:"ApplyCashCOC"},POISearchModel:{url:"POISearchQOC"},GroupSearchModel:{url:"GroupSearchQOC"},ContinueToPayModel:{protocol:"https",url:"ContinueToPayQOC"},OrderRefundInfoList:{protocol:"https",url:"OrderRefundInfoListQOC"},NotIntoGardenMessage:{protocol:"https",url:"NotIntoGardenMessageCOC"},ResourceInsuranceInfo:{protocol:"https",url:"ResourceInsuranceInfoQOC"},GSAProductRecommend:{url:"GSAProductRecommendQOC"}},o=n.createModels(a,i.getRestfulApi);return o}),define("payment",["cUtilDate","cHybridShell","TicketConfig","UIAlert"],function(t,e,i,n){return{paytypename:{"-1":"景点付款",0:"在线支付",1:"礼品卡",2:"信用卡或储蓄卡",4:"第三方支付",8:"钱包支付",16:"现金支付"},payment:function(t){var e=window.__payment__.url,i=window.__payment__.path,n=window.__payment__.page;return{url:e+i+"/"+n+"?"+t,path:i,param:n+"?"+t,baseUrl:e+i+"/"+n}},getPayCallback:function(t,e){var i={orderID:t.oid,payType:"-1",busType:t.bustype,price:t.amount,title:t.title,type:"cn_ticket"},n={title:t.title,type:"cn_ticket"},r=e.localPath(),a="bookingcomplete?"+e.json2url(i),o=r+"bookingcomplete?"+e.json2url(n),s="",c=t.error;return{complete:a,returns:s,success:o,error:c}},_createH5PostForm:function(t,e){var i=$('<form target="_self" style="display: none;" method="post"></form>');i.attr("action",t);for(var n in e)i.append($("<input/>").attr({name:n,value:e[n]}));return i},dopay:function(r,a,o,s,c,l,d,h,u,m){var f=this.getPayCallback(r,s),p=f.returns,g=f.success,y=this,C=f.error,_={oid:r.oid,bustype:r.bustype,requestid:r.requestid,islogin:h?0:1,from:location.href,rback:p,sback:g,eback:C,auth:r.auth,title:r.title,amount:r.amount||r.amt,recall:r.recall,extno:r.extno},T={useEType:1,subPayType:0,payTypeList:a.paytypelist,subPayTypeList:a.subpaytypelist,payWayWhiteList:a.paywaywhitelist,IsNeedCardRisk:!0,CardNumSegmentList:a.cardnumsegmentlist};if(r.limcount&&r.promkey&&(T.ActivityKey=r.promkey,T.MaxActivityCount=r.limcount),m&&"19801"==m.aid&&"449843"==m.sid){if(!((6&T.payTypeList)>0&&(7&T.subPayTypeList)>0))return void new n({datamodel:{content:"不能继续支付",btns:[{name:"确定",className:"cui-btns-ok"}]},events:{"click .cui-btns-ok":"okAction"},okAction:function(){return this.hide(),!0}}).show();T.payTypeList=32,delete T.subPayTypeList,T.payWayWhiteList="EB_CCB",T.osType=i.isIOS?1:2}r.isnewpay&&(T.isRealTimePay=1,T.isAutoApplyBill=1),_=encodeURIComponent(o.Base64.encode(JSON.stringify(_))),T=encodeURIComponent(o.Base64.encode(JSON.stringify(T)));var v={bustype:r.bustype,oid:r.oid,token:_,extend:T};r.psign&&(v.Sign=r.psign),r.ptoken&&(v.token=encodeURIComponent(o.Base64.encode(JSON.stringify(r.ptoken)))),r.pextend&&(v.extend=encodeURIComponent(o.Base64.encode(JSON.stringify(r.pextend))));var k=s.json2url(v),S=c.payment(k);l.apply({callback:function(){y._createH5PostForm(S.baseUrl,v).submit()},hybridCallback:function(){if(u){for(var i=[],n=[],a=0,o=u.tickets.length;o>a;a++){var s=u.tickets[a];i.push({KOrderDetailMinorTitle:s.pgrpname,KOrderDetailMinorValue:"￥"+s.price+" X "+s.qty,KOrderDetailMinorComment:t.parse(s.udate).format("Y年m月d日")+"-"+s.rname})}u.insurance&&u.insurance.insuprice&&u.insurance.insu_quantity&&i.push({KOrderDetailMinorTitle:"附加保险",KOrderDetailMinorValue:"￥"+u.insurance.insuprice+" X "+u.insurance.insu_quantity}),u.coupon&&Math.abs(u.coupon)>0&&i.push({KOrderDetailMinorTitle:"优惠券",KOrderDetailMinorValue:"-￥"+Math.abs(u.coupon)});
for(var a=0,o=u.passengers.length;o>a;a++){var s=u.passengers[a],c=(s.carddesc&&s.cardno?s.carddesc+"  "+s.cardno+"\n":"")+(s.phone?"手机号  "+s.phone:"");n.push({KOrderDetailMinorTitle:s.name,KOrderDetailMinorComment:c})}var d={requestid:r.requestid,KOrderSummary:{KOrderMainTitle:r.title,KOrderMinorTitle:"请在"+r.petime+"分钟内完成支付,否则该订单将被自动取消"},KOrderDetail:[{KOrderDetailMainTitle:"费用明细：",KOrderDetailMinor:i},{KOrderDetailMainTitle:"出行人：",KOrderDetailMinor:n}]};u.email&&d.KOrderDetail.push({KOrderDetailMainTitle:"电子邮箱: ",KOrderDetailMainValue:u.email});var h=new e.Fn("do_business_job",function(){l.pay.callPay({path:S.path,param:S.param})});h.run(4,10002,d)}else l.pay.callPay({path:S.path,param:S.param})}})}}}),define("pageId",{pageid:{index:[212077,213077],citylist:[214422,215422],search:[214423,215423],list:[214424,215424],detail:[214427,215427],bookingnotice:[214428,215428],map:[214436,215436],booking:["",""],bookingP:[214430,215430],bookingO:[214438,215438],usedate:[214431,215431],addmoretk:[214432,215432],choosetraveler:[214437,215437],orderdetail:[214434,215434],orderdetailinsurance:[600000446,600000447],bookingcomplete:[214435,215435],coupon:[214440,215440],comment:[214439,215439],managetraveler:[212100,213101],picturelist:[214441,215441],pictureview:[214442,215442],remark:[238011,403003],detailattr:[238013,403005],ordercancel:[420015,422013],bookinginsurance:[600000444,600000445],"default":[212060,213060]}}),define("errorMsg",{errormsg:{2001:"获取匿名授权错误",2002:"用户信息不能为空",2003:"联系人信息不能为空",2004:"门票信息不能为空",2005:"门票份数不在正确范围之内",2006:"支付类型只能为现付或者预付",2007:"门票使用日期不正确"}}),define("TicketCommon",["require","TicketConfig","TicketStore","cUtility","GRuntimeService","payment","pageId","GStoreFactory","errorMsg","GFormat","cGuider"],function(t){var e=t("TicketConfig"),i=t("TicketStore"),n=t("cUtility"),r=t("GRuntimeService"),a=t("payment"),o=t("pageId"),s=t("GStoreFactory"),c=t("errorMsg"),l=(t("GFormat"),s.createStores()),d=(l.GGeoLocationStore.getInstance(),t("cGuider"),i.AllianceExtend.getInstance());d.setURLParamsToStore("ext");var h={pageid:function(t){var e=o.pageid;return e[t]?e[t][0]:""},hpageid:function(t){var e=o.pageid;return e[t]?e[t][1]:""},error:function(t,e){var i=c.errormsg;return t.errmsg||t.head&&t.head.errcode&&i[""+t.head.errcode]||e||"网络不给力，请稍后重试"},onError:function(t,e){e.hideLoading(),e.showToast(this.error(t))},setHeader:function(t,e,i){n.isInApp;t.headerview.set(e),i&&i.html(e.title),t.headerview.show()},getPayTypeName:function(t){var e=a.paytypename;return t="-1"===t?-1:0,e[""+t]}};return 3===r.getRunTime()&&(window.rawAlert=window.alert,window.alert=function(){},e.logAble=!1),window._alert=function(){var t=e.alertAble&&window.rawAlert?window.rawAlert:window.alert;t.apply(window,[].slice.call(arguments))},_.extend(Function.prototype,{before:function(t){var e=this;return function(){t(),e.apply(this,_.toArray(arguments))}},after:function(t){var e=this;return function(){e.apply(this,_.toArray(arguments)),t()}},bind2:function(){var t=this,e=_.toArray(arguments),i=e.shift();return function(){t.apply(i,_.toArray(arguments).concat(e))}}}),h}),define("TicketCommonService",["require","cCoreInherit","CommonStore"],function(t){var e=t("cCoreInherit"),i=t("CommonStore"),n=new e.Class({initialize:function(){},getHeaderData:function(){var t;return function(){return t||(t=i.HeadStore.getInstance().get()||{})}}(),getUnionData:function(){var t;return function(){return t||(t=i.UnionStore.getInstance().get()||{})}}(),getSaleObject:function(){var t;return function(){return t||(t=i.SalesObjectStore.getInstance().get()||{})}}()});return n.getInstance=function(){return this.instance||(this.instance=new this)},n}),define("TicketCommand",["require","cCoreInherit","TicketConfig","TicketStore","TicketCommonService","GRuntimeService","GCommand"],function(t){var e=t("cCoreInherit"),i=t("TicketConfig"),n=t("TicketStore"),r=t("TicketCommonService"),a=t("GRuntimeService"),o=t("GCommand"),s={serverDate:{description:"输出服务器时间",alias:["sd"]},clearLocalStorage:{description:"清除localStorage",alias:["cl"]},showDeveloper:{description:"显示开发人员",alias:["d","dev"],args:{a:{description:"显示全部",require:!1,"default":""},c:{description:"输出数量",require:!1,"default":100,reg:/^\d+$/,validate:function(t){return parseInt(t)<100}}}},showVersion:{description:"显示版本号",alias:["v","ver"],args:{}},showRunEnvironment:{description:"显示运行环境",alias:["re"]},showGps:{description:"显示定位数据",alias:["gps"]},showCid:{description:"显示cid",alias:["cid"]},debug:{description:"开启调试模式",alias:[],args:{alert:{description:"是否开启alert",require:!1,"default":!0},re:{description:"模拟RunEnvironment",require:!1,"default":-1},log:{description:"是否开启log",require:!1,"default":!1}}},positionDuration:{description:"设置定位最小间隔时间",alias:["pos"],args:{d:{description:"间隔时间",require:!1,"default":30}}}},c=new e.Class(o,{showDeveloper:function(){var t=["票贩子码农：","叶知秋","人参果好好吃","北国骑士","快乐的穷光蛋","幸福目标","oοゞ非伱ńō娶ゞοo","On the road","AngelHood"];return function(e){var i=parseInt(e.c),n=i&&!isNaN(i)?t.slice(0,i+1):t;return n.join("\n")}}(),showVersion:function(){return"ver:"+i.buildVersion},clearLocalStorage:function(){return localStorage.clear(),"localStorage clear!"},serverDate:function(){return window.__SERVERDATE__.server},showRunEnvironment:function(){return"runtime:"+a.getRunTime()},showGps:function(){var t=n.TicketGeoLocationStore.getInstance().get(),e=n.TicketSelectedCityStore.getInstance().get(),i=n.TicketGeoCityStore.getInstance().get(),r=n.TicketGeoCityStore.getInstance().get();return["geoLocationStore:"+JSON.stringify(t),"selectedCityStore:"+JSON.stringify(e),"lastGeoCityStore:"+JSON.stringify(i),"geoCityStore:"+JSON.stringify(r)].join("\n---------\n")},showCid:function(){var t=r.getInstance(),e=t.getHeaderData()?t.getHeaderData().cid:"unknown";return"cid:"+e},debug:function(t){return t.alert&&(i.alertAble="0"!==t.alert&&"false"!==t.alert),t.re&&(i.runTime=parseInt(t.re)),t.log&&(i.logAble="0"!==t.alert&&"false"!==t.alert),["alertAble:"+i.alertAble,"logAble:"+i.logAble,"runTime:"+i.runTime].join("\n")},positionDuration:function(t){return i.posDuration=parseFloat(t.d),"position duration:"+t.d+"minutes"}});return c.getInstance=function(){return this.instance||(this.instance=new this(s))},c}),define("country",{countryList:[{einitial:"C",id:46,name:"中国大陆",scode:"CN"},{einitial:"H",id:92,name:"中国香港",scode:"HK"},{einitial:"M",id:141,name:"中国澳门",scode:"MO"},{einitial:"T",id:218,name:"中国台湾",scode:"TW"},{einitial:"U",id:223,name:"美国",scode:"US"},{einitial:"U",id:75,name:"英国",scode:"GB"},{einitial:"J",id:109,name:"日本",scode:"JP"},{einitial:"C",id:36,name:"加拿大",scode:"CA"},{einitial:"F",id:73,name:"法国",scode:"FR"},{einitial:"K",id:117,name:"韩国",scode:"KR"},{einitial:"G",id:55,name:"德国",scode:"DE"},{einitial:"D",id:56,name:"吉布提",scode:"DJ"},{einitial:"D",id:57,name:"丹麦",scode:"DK"},{einitial:"D",id:58,name:"多米尼克",scode:"DM"},{einitial:"D",id:59,name:"多米尼加",scode:"DO"},{einitial:"A",id:60,name:"阿尔及利亚",scode:"DZ"},{einitial:"E",id:61,name:"厄瓜多尔",scode:"EC"},{einitial:"E",id:62,name:"爱沙尼亚",scode:"EE"},{einitial:"E",id:63,name:"埃及",scode:"EG"},{einitial:"W",id:64,name:"西撒哈拉",scode:"EH"},{einitial:"E",id:65,name:"厄立特里亚",scode:"ER"},{einitial:"S",id:66,name:"西班牙",scode:"ES"},{einitial:"E",id:67,name:"埃塞俄比亚",scode:"ET"},{einitial:"F",id:68,name:"芬兰",scode:"FI"},{einitial:"F",id:69,name:"斐济",scode:"FJ"},{einitial:"F",id:70,name:"福克兰群岛（马尔维纳斯）",scode:"FK"},{einitial:"M",id:71,name:"密克罗尼西亚",scode:"FM"},{einitial:"F",id:72,name:"法罗群岛",scode:"FO"},{einitial:"C",id:37,name:"科科斯（基林）群岛",scode:"CC"},{einitial:"C",id:38,name:"刚果（金）",scode:"CD"},{einitial:"C",id:39,name:"中非",scode:"CF"},{einitial:"C",id:40,name:"刚果（布）",scode:"CG"},{einitial:"S",id:41,name:"瑞士",scode:"CH"},{einitial:"C",id:42,name:"科特迪瓦",scode:"CI"},{einitial:"C",id:43,name:"库克群岛",scode:"CK"},{einitial:"C",id:44,name:"智利",scode:"CL"},{einitial:"C",id:45,name:"喀麦隆",scode:"CM"},{einitial:"C",id:47,name:"哥伦比亚",scode:"CO"},{einitial:"C",id:48,name:"哥斯达黎加",scode:"CR"},{einitial:"S",id:49,name:"塞尔维亚",scode:"CS"},{einitial:"C",id:50,name:"古巴",scode:"CU"},{einitial:"C",id:51,name:"佛得角",scode:"CV"},{einitial:"C",id:52,name:"圣诞岛",scode:"CX"},{einitial:"C",id:53,name:"塞浦路斯",scode:"CY"},{einitial:"C",id:54,name:"捷克",scode:"CZ"},{einitial:"A",id:1,name:"安道尔",scode:"AD"},{einitial:"U",id:2,name:"阿联酋",scode:"AE"},{einitial:"A",id:3,name:"阿富汗",scode:"AF"},{einitial:"A",id:4,name:"安提瓜和巴布达",scode:"AG"},{einitial:"A",id:5,name:"安圭拉",scode:"AI"},{einitial:"A",id:6,name:"阿尔巴尼亚",scode:"AL"},{einitial:"A",id:7,name:"亚美尼亚",scode:"AM"},{einitial:"N",id:8,name:"荷属安的列斯",scode:"AN"},{einitial:"A",id:9,name:"安哥拉",scode:"AO"},{einitial:"A",id:10,name:"南极洲",scode:"AQ"},{einitial:"A",id:11,name:"阿根廷",scode:"AR"},{einitial:"A",id:12,name:"美属萨摩亚",scode:"AS"},{einitial:"A",id:13,name:"奥地利",scode:"AT"},{einitial:"A",id:14,name:"澳大利亚",scode:"AU"},{einitial:"A",id:15,name:"阿鲁巴",scode:"AW"},{einitial:"A",id:16,name:"阿塞拜疆",scode:"AZ"},{einitial:"B",id:17,name:"波黑",scode:"BA"},{einitial:"B",id:18,name:"巴巴多斯",scode:"BB"},{einitial:"B",id:19,name:"孟加拉国",scode:"BD"},{einitial:"B",id:20,name:"比利时",scode:"BE"},{einitial:"B",id:21,name:"布基纳法索",scode:"BF"},{einitial:"B",id:22,name:"保加利亚",scode:"BG"},{einitial:"B",id:23,name:"巴林",scode:"BH"},{einitial:"B",id:24,name:"布隆迪",scode:"BI"},{einitial:"B",id:25,name:"贝宁",scode:"BJ"},{einitial:"B",id:26,name:"百慕大",scode:"BM"},{einitial:"B",id:27,name:"文莱",scode:"BN"},{einitial:"B",id:28,name:"玻利维亚",scode:"BO"},{einitial:"B",id:29,name:"巴西",scode:"BR"},{einitial:"B",id:30,name:"巴哈马",scode:"BS"},{einitial:"B",id:31,name:"不丹",scode:"BT"},{einitial:"B",id:32,name:"布维岛",scode:"BV"},{einitial:"B",id:33,name:"博茨瓦纳",scode:"BW"},{einitial:"B",id:34,name:"白俄罗斯",scode:"BY"},{einitial:"B",id:35,name:"伯利兹",scode:"BZ"},{einitial:"N",id:142,name:"北马里亚纳",scode:"MP"},{einitial:"M",id:143,name:"马提尼克",scode:"MQ"},{einitial:"M",id:144,name:"毛里塔尼亚",scode:"MR"},{einitial:"M",id:145,name:"蒙特塞拉特",scode:"MS"},{einitial:"M",id:146,name:"马耳他",scode:"MT"},{einitial:"M",id:147,name:"毛里求斯",scode:"MU"},{einitial:"M",id:148,name:"马尔代夫",scode:"MV"},{einitial:"M",id:149,name:"马拉维",scode:"MW"},{einitial:"M",id:150,name:"墨西哥",scode:"MX"},{einitial:"M",id:151,name:"马来西亚",scode:"MY"},{einitial:"M",id:152,name:"莫桑比克",scode:"MZ"},{einitial:"N",id:153,name:"纳米尼亚",scode:"NA"},{einitial:"N",id:154,name:"新喀里多尼亚",scode:"NC"},{einitial:"N",id:155,name:"尼日尔",scode:"NE"},{einitial:"N",id:156,name:"诺福克岛",scode:"NF"},{einitial:"N",id:157,name:"尼日利亚",scode:"NG"},{einitial:"N",id:158,name:"尼加拉瓜",scode:"NI"},{einitial:"N",id:159,name:"荷兰",scode:"NL"},{einitial:"N",id:160,name:"挪威",scode:"NO"},{einitial:"N",id:161,name:"尼泊尔",scode:"NP"},{einitial:"N",id:162,name:"瑙鲁",scode:"NR"},{einitial:"N",id:163,name:"纽埃",scode:"NU"},{einitial:"N",id:164,name:"新西兰",scode:"NZ"},{einitial:"O",id:165,name:"阿曼",scode:"OM"},{einitial:"P",id:166,name:"巴拿马",scode:"PA"},{einitial:"P",id:167,name:"秘鲁",scode:"PE"},{einitial:"F",id:168,name:"法属波利尼西亚",scode:"PF"},{einitial:"P",id:169,name:"巴布亚新几内亚",scode:"PG"},{einitial:"P",id:170,name:"菲律宾",scode:"PH"},{einitial:"P",id:171,name:"巴基斯坦",scode:"PK"},{einitial:"P",id:172,name:"波兰",scode:"PL"},{einitial:"S",id:173,name:"圣皮埃尔和密克隆",scode:"PM"},{einitial:"P",id:174,name:"皮特凯恩",scode:"PN"},{einitial:"P",id:175,name:"波多黎各",scode:"PR"},{einitial:"P",id:176,name:"巴勒斯坦",scode:"PS"},{einitial:"P",id:177,name:"葡萄牙",scode:"PT"},{einitial:"P",id:178,name:"帕劳",scode:"PW"},{einitial:"P",id:179,name:"巴拉圭",scode:"PY"},{einitial:"Q",id:180,name:"卡塔尔",scode:"QA"},{einitial:"R",id:181,name:"留尼汪",scode:"RE"},{einitial:"R",id:182,name:"罗马尼亚",scode:"RO"},{einitial:"R",id:183,name:"俄罗斯",scode:"RU"},{einitial:"R",id:184,name:"卢旺达",scode:"RW"},{einitial:"S",id:185,name:"沙特阿拉伯",scode:"SA"},{einitial:"S",id:186,name:"所罗门群岛",scode:"SB"},{einitial:"S",id:187,name:"塞舌尔",scode:"SC"},{einitial:"S",id:188,name:"苏丹",scode:"SD"},{einitial:"S",id:189,name:"瑞典",scode:"SE"},{einitial:"S",id:190,name:"新加坡",scode:"SG"},{einitial:"S",id:191,name:"圣赫勒拿",scode:"SH"},{einitial:"S",id:192,name:"斯洛文尼亚",scode:"SI"},{einitial:"S",id:193,name:"斯瓦尔巴岛和扬马延岛",scode:"SJ"},{einitial:"S",id:194,name:"斯洛伐克",scode:"SK"},{einitial:"S",id:195,name:"塞拉利昂",scode:"SL"},{einitial:"S",id:196,name:"圣马力诺",scode:"SM"},{einitial:"S",id:197,name:"塞内加尔",scode:"SN"},{einitial:"S",id:198,name:"索马里",scode:"SO"},{einitial:"S",id:199,name:"苏里南",scode:"SR"},{einitial:"S",id:200,name:"圣多美和普林西比",scode:"ST"},{einitial:"E",id:201,name:"萨尔瓦多",scode:"SV"},{einitial:"S",id:202,name:"叙利亚",scode:"SY"},{einitial:"S",id:203,name:"斯威士兰",scode:"SZ"},{einitial:"T",id:204,name:"特克斯和凯科斯群岛",scode:"TC"},{einitial:"C",id:205,name:"乍得",scode:"TD"},{einitial:"F",id:206,name:"法属南部领土",scode:"TF"},{einitial:"T",id:207,name:"多哥",scode:"TG"},{einitial:"T",id:208,name:"泰国",scode:"TH"},{einitial:"T",id:209,name:"塔吉克斯坦",scode:"TJ"},{einitial:"T",id:210,name:"托克劳",scode:"TK"},{einitial:"T",id:211,name:"土库曼斯坦",scode:"TM"},{einitial:"T",id:212,name:"突尼斯",scode:"TN"},{einitial:"T",id:213,name:"汤加",scode:"TO"},{einitial:"E",id:214,name:"东帝汶",scode:"TP"},{einitial:"T",id:215,name:"土耳其",scode:"TR"},{einitial:"T",id:216,name:"特立尼达和多巴哥",scode:"TT"},{einitial:"T",id:217,name:"图瓦卢",scode:"TV"},{einitial:"K",id:118,name:"科威特",scode:"KW"},{einitial:"C",id:119,name:"开曼群岛",scode:"KY"},{einitial:"K",id:120,name:"哈萨克斯坦",scode:"KZ"},{einitial:"L",id:121,name:"老挝",scode:"LA"},{einitial:"L",id:122,name:"黎巴嫩",scode:"LB"},{einitial:"S",id:123,name:"圣卢西亚",scode:"LC"},{einitial:"L",id:124,name:"列支敦士登",scode:"LI"},{einitial:"S",id:125,name:"斯里兰卡",scode:"LK"},{einitial:"L",id:126,name:"利比里亚",scode:"LR"},{einitial:"L",id:127,name:"莱索托",scode:"LS"},{einitial:"L",id:128,name:"立陶宛",scode:"LT"},{einitial:"L",id:129,name:"卢森堡",scode:"LU"},{einitial:"L",id:130,name:"拉脱维亚",scode:"LV"},{einitial:"L",id:131,name:"利比亚",scode:"LY"},{einitial:"M",id:132,name:"摩洛哥",scode:"MA"},{einitial:"M",id:133,name:"摩纳哥",scode:"MC"},{einitial:"M",id:134,name:"摩尔多瓦",scode:"MD"},{einitial:"M",id:135,name:"马达加斯加",scode:"MG"},{einitial:"M",id:136,name:"马绍尔群岛",scode:"MH"},{einitial:"M",id:137,name:"前南马其顿",scode:"MK"},{einitial:"M",id:138,name:"马里",scode:"ML"},{einitial:"M",id:139,name:"缅甸",scode:"MM"},{einitial:"M",id:140,name:"蒙古",scode:"MN"},{einitial:"U",id:224,name:"乌拉圭",scode:"UY"},{einitial:"U",id:225,name:"乌兹别克斯坦",scode:"UZ"},{einitial:"V",id:226,name:"梵蒂冈",scode:"VA"},{einitial:"S",id:227,name:"圣文森特和格林纳丁斯",scode:"VC"},{einitial:"V",id:228,name:"委内瑞拉",scode:"VE"},{einitial:"V",id:229,name:"英属维尔京群岛",scode:"VG"},{einitial:"V",id:230,name:"美属维尔京群岛",scode:"VI"},{einitial:"V",id:231,name:"越南",scode:"VN"},{einitial:"V",id:232,name:"瓦努阿图",scode:"VU"},{einitial:"W",id:233,name:"瓦利斯和富图纳",scode:"WF"},{einitial:"S",id:234,name:"萨摩亚",scode:"WS"},{einitial:"Y",id:235,name:"也门",scode:"YE"},{einitial:"M",id:236,name:"马约特",scode:"YT"},{einitial:"Y",id:237,name:"南斯拉夫",scode:"YU"},{einitial:"S",id:238,name:"南非",scode:"ZA"},{einitial:"Z",id:239,name:"赞比亚",scode:"ZM"},{einitial:"Z",id:240,name:"津巴布韦",scode:"ZW"},{einitial:"G",id:76,name:"格林纳达",scode:"GD"},{einitial:"G",id:77,name:"格鲁吉亚",scode:"GE"},{einitial:"F",id:78,name:"法属圭亚那",scode:"GF"},{einitial:"G",id:79,name:"加纳",scode:"GH"},{einitial:"G",id:80,name:"直布罗陀",scode:"GI"},{einitial:"G",id:81,name:"格陵兰",scode:"GL"},{einitial:"G",id:82,name:"冈比亚",scode:"GM"},{einitial:"G",id:83,name:"几内亚",scode:"GN"},{einitial:"G",id:84,name:"瓜德罗普",scode:"GP"},{einitial:"E",id:85,name:"赤道几内亚",scode:"GQ"},{einitial:"G",id:86,name:"希腊",scode:"GR"},{einitial:"S",id:87,name:"南乔治亚岛和南桑德韦奇岛",scode:"GS"},{einitial:"G",id:88,name:"危地马拉",scode:"GT"},{einitial:"G",id:89,name:"关岛",scode:"GU"},{einitial:"G",id:90,name:"几内亚比绍",scode:"GW"},{einitial:"G",id:91,name:"圭亚那",scode:"GY"},{einitial:"H",id:93,name:"赫德岛和麦克唐纳岛",scode:"HM"},{einitial:"H",id:94,name:"洪都拉斯",scode:"HN"},{einitial:"C",id:95,name:"克罗地亚",scode:"HR"},{einitial:"H",id:96,name:"海地",scode:"HT"},{einitial:"H",id:97,name:"匈牙利",scode:"HU"},{einitial:"I",id:98,name:"印度尼西亚",scode:"ID"},{einitial:"I",id:99,name:"爱尔兰",scode:"IE"},{einitial:"I",id:100,name:"以色列",scode:"IL"},{einitial:"I",id:101,name:"印度",scode:"IN"},{einitial:"B",id:102,name:"英属印度洋领地",scode:"IO"},{einitial:"I",id:103,name:"伊拉克",scode:"IQ"},{einitial:"I",id:104,name:"伊朗",scode:"IR"},{einitial:"I",id:105,name:"冰岛",scode:"IS"},{einitial:"I",id:106,name:"意大利",scode:"IT"},{einitial:"J",id:107,name:"牙买加",scode:"JM"},{einitial:"J",id:108,name:"约旦",scode:"JO"},{einitial:"G",id:74,name:"加蓬",scode:"GA"},{einitial:"T",id:219,name:"坦桑尼亚",scode:"TZ"},{einitial:"U",id:220,name:"乌克兰",scode:"UA"},{einitial:"U",id:221,name:"乌干达",scode:"UG"},{einitial:"U",id:222,name:"美国本土外小岛屿",scode:"UM"},{einitial:"K",id:110,name:"肯尼亚",scode:"KE"},{einitial:"K",id:111,name:"吉尔吉斯斯坦",scode:"KG"},{einitial:"C",id:112,name:"柬埔寨",scode:"KH"},{einitial:"K",id:113,name:"基里巴斯",scode:"KI"},{einitial:"C",id:114,name:"科摩罗",scode:"KM"},{einitial:"S",id:115,name:"圣基茨和尼维斯",scode:"KN"},{einitial:"K",id:116,name:"朝鲜",scode:"KP"}]}),define("formItem",{cards:{1:"身份证",2:"护照",3:"学生证",4:"军人证",6:"驾驶证",7:"回乡证",8:"台胞证",10:"港澳通行证",11:"国际海员证",20:"外国人永久居住证",21:"旅行证",22:"台湾通行证",23:"士兵证",24:"临时身份证",25:"户口簿",26:"警官证",99:"其他"},inputs:{1:["NameCN","中文名","name"],2:["NameENFirstName,NameENMiddleName,NameENLastName","英文名","ename"],3:["NameCN,NameENFirstName,NameENMiddleName,NameENLastName","姓名",["name","ename"]],4:["Nationality","国籍","nat"],5:["Cards","证件类型","cardtype"],6:["Gender","性别","gen"],7:["CardNo","证件号","cardno"],8:["Birthday","出生日期","birth"],9:["BirthPlace","出生地"],10:["IdCardTimelimit","证件有效期","ictl"],11:["MobilePhone","联系电话","phone"]},gender:[{id:1,type:"男"},{id:0,type:"女"}]}),define("ubt",{UBT_URL:{INDEX:{ONLOAD:"source=${source}&eventname=homepage_onload&page_id=${page_id}&cityid=${cityid}",SEARCH_TO_DETAIL:"source=&eventname=st_homepage_assword_click&page_id=&traceid=&clientcode=${clientcode}&long=${long}&lat=${lat}&poscityid=${poscityid}&sitecityid=${sitecityid}&pagefrom=${pagefrom}&searchtype=${searchtype}&searchtypevalue=${searchtypevalue}&userinput=${userinput}&recordquantity=${recordquantity}&rows_searchtbx=${rows_searchtbx}&clickindex_searchtbx=${clickindex_searchtbx}",SEARCH:"source=&eventname=homepage_search_txt&page_id=",BANNER:"source=&eventname=Advitise_Page&page_id=&advertiseid=${advertiseId}",TOPIC:"source=&eventname=Advitise_Theme&page_id=&advertiseid=${advertiseId}",OVERSEA_CITY:"source=&eventname=OverseaCity_button&CityID=${cityId}",RECOMMEND:"source=&eventname=Select_Ticket&page_id=&productid=${productId}",CHANGE_CITY:"source=&eventname=homepage_changecity_btn&page_id=&selectedcityid=${cityid}",POSITION:"source=${source}&eventname=homepage_userlocation_event&page_id=${page_id}&longitude=${longitude}&latitude=${latitude}&locationcityid=${locationcityid}&clientcode=${clientcode}"},LIST_SEARCH_TO_DETAIL:"source=&eventname=st_listpage_assword_click&page_id=&traceid=${traceid}&clientcode=${clientcode}&long=${long}&lat=${lat}&poscityid=${poscityid}&sitecityid=${sitecityid}&pagefrom=${pagefrom}&searchtype=${searchtype}&searchtypevalue=${searchtypevalue}&userinput=${userinput}&recordquantity=${recordquantity}&rows_searchtbx=${rows_searchtbx}&clickindex_searchtbx=${clickindex_searchtbx}",LIST_ENTER:"source=${source}&eventname=st_listpage_onload&page_id=${page_id}&traceid=${traceid}&channel=${channel}&clientcode=${clientcode}&long=${long}&lat=${lat}&poscityid=${poscityid}&sitecityid=${sitecityid}&pagefrom=${pagefrom}&searchtype=${searchtype}&searchtypevalue=${searchtypevalue}&userinput=${userinput}&themeids=${themeids}&paymode=${paymode}&isnowuse=${isnowuse}&lcid=${lcid}&radiusmax=${radiusmax}&sortby=${sortby}&recordquantity=${recordquantity}",LIST_THEME_OR_CITY:"source=${source}&eventname=listpage_quickfilter_btn&page_id=${page_id}&filtertype=${filtertype}&selectedvalue=${selectedvalue}",HOTWORD:"source=&eventname=HotWord_button&keyword=${keyword}",SEARCH:"source=&page_id=&recordquantity=${count}&theme=&keyword=&city=",SEARCH_NEW:"source=&eventname=listpage_search_btn&page_id=",LIST_SEARCH:"source=&eventname=listpage_search_icon&page_id=",LIST:"source=&page_id=&recordquantity=${count}&theme=&keyword=&city=",LIST_CHANGE_CITY:"source=&eventname=listpage_changecity_btn&page_id=&selectedcityid=${cityid}",LIST_FILTER:"source=&eventname=filter_button&page_id==&themeids=&paymode=&isnowuse=&lpid=&lcid=&radiusmax=",DETAIL:{YYONLOADE:"source=&eventname=dtlpage_load&page_id=&viewspotid=&cityid=&cityidfrom=&uid=",ONLOADE:"source=&eventname=st_dtlpage_onload&page_id=&viewspotid=&cityid=&cityidfrom=&uid=&pretraceid=&clickindex=&label=",FAVORITE:"source=&eventname=detailpage_favorites_btn&page_id=&viewspotid=",SUGGEST_LOAD:"source=&eventname=alsobrowse_load&page_id=&viewspotid=&viewspotidlist_recommend=",SUGGEST_CLICK:"source=&eventname=alsobrowse_click&page_id=&viewspotid=&viewspotid_recommend=",PIC_CLICK:"source=&eventname=dtlpage_pic_btn&page_id=&viewspotid=&isavailable="}},UBT_KEY:{HOME:"ticket.home",SEARCH:"ticket.search",LIST:"ticket.list",DETAIL:"ticket.detail",LIST_PUB:"ticket.list_pub_h5app",DETAIL_PUB:"ticket.detail_pub_h5app",BOOKING_WRITE_PUB:"ticket.write_pub_h5app",BOOKING_COMPLETE_PUB:"ticket.ordered_pub_h5app",BOOKING_PAUSE:"ticket.write"}}),define("traveler",{selectGender:function(t,e,i){function n(t){var n=$(t.target),r=n.attr("data-index"),c=s[r];this.setIndex(r),a.val(c.id),o.html(c.name),e&&(f.passengers[0].gen=c.id,i.set(f)),this.hide()}for(var r=this.$el.find("#gender_list option"),a=this.$el.find("#gender_list"),o=this.$el.find("#gender_data"),s=[],c=this,l=0,d=0,h=r.length;h>d;d++){var u={},m=$(r[d]);m.attr("selected")&&(l=d),u.id=m.val(),u.name=m.html(),u["data-no"]=m.attr("data-no"),s.push(u)}var f;e&&(f=c.selectInitbookingParam());var p=new t({datamodel:{title:"选择性别",index:l,data:s},events:{"click .cui-select-view> li":"myClickAction"},myClickAction:n});return p.show(),p},selectCard:function(t,e,i,n){var r=$(t.target).closest("#sel_idCard,#selectcard");if(!r.hasClass("noPop")){for(var a=this.$el.find("#card_list option"),o=this.$el.find("#card_list"),s=this.$el.find("#card_type_data"),c=this.$el.find("#card_no"),l=[],d=0,h=this,u=0,m=a.length;m>u;u++){var f={},p=$(a[u]);p.attr("selected")&&(d=u),f.key=p.val(),f.val=p.html(),f["data-no"]=p.attr("data-no");var g=$.trim(p.data("value"));g&&(f["data-value"]=g),l.push(f)}var y;i&&(y=h.selectInitbookingParam()),$.each(l,function(t,e){e.id=e.val});var h=this;return this.idCardList=new e({datamodel:{title:"证件类型",data:l},events:{"click .cui-select-view> li":"myClickAction"},myClickAction:function(t){var e=$(t.target),r=e.attr("data-index"),a=l[r];this.setIndex(r),o.val(a.key),s.html(a.val),s.attr("datano",a.key),1==a.key?h.$el.find(".cardno_dis_com").addClass("identity-no").find("input").attr("readonly","true"):h.$el.find(".cardno_dis_com").removeClass("identity-no").find("input").removeAttr("readonly"),c.val(a["data-value"]||""),i&&(y.passengers[0].cardtype=a.key,n.set(y)),1==a.key?$("#sel_gender,#sel_birthday").hide():$("#sel_gender,#sel_birthday").show(),this.hide()}}),this.idCardList.setIndex(d),this.idCardList.show(),this.idCardList}},isValidDateStr:function(t){var e=/^(\d+)-(\d{1,2})-(\d{1,2})$/,i=t.match(e);if(null==i)return!1;i[2]=i[2]-1;var n=new Date(i[1],i[2],i[3]);return n.getFullYear()!=i[1]?!1:n.getMonth()!=i[2]?!1:!0},selectBirthDate:function(t,e,i,n){function r(e){var r=e[0],c=e[1],l=(e[2],r.id+"-"+((c.id<10?"0":"")+c.id)+"-"+((c.id<10?"0":"")+c.id));t.isValidDateStr(l)?(o.html(l),i&&(a.passengers[0].birth=l,n.set(a))):s.showToast("日期格式不正确，请重新选择！",3,function(){},!0)}var a,o=this.$el.find("#birthday_date"),s=this,c=1900,l=(new Date).getFullYear()+10,d=t._calculateSelectDate(c,l);return i&&(a=s.selectInitbookingParam()),t._createDateSelect({data:d,indexArr:t.formatInitDate($.trim(o.text()||""),c),datamodel:{title:"选择出生日期",tips:""},onOkAction:r},e)},_calculateSelectDate:function(t,e){var i,n,r=[];for(i=t;e>i;i++)r.push({id:i,name:i});var a=[];for(i=0;12>i;i++)n=i+1,a.push({id:n,name:(10>n?"0":"")+n});var o=[];for(i=0;31>i;i++)n=i+1,o.push({id:n,name:(10>n?"0":"")+n});return[r,a,o]},_createDateSelect:function(t,e){function i(){var t=n.scrollArr[0].getSelected(),e=n.scrollArr[1].getSelected(),i={1:31,2:28,3:31,4:30,5:31,6:30,7:31,8:31,9:30,10:31,11:30,12:31};_.dateUtil.isLeapYear(t.id)&&(i[2]=29);for(var r=!1,a=0;31>a;a++)c[a].disabled=!0;for(a=31;a>i[e.id]&&a>0;a--)c[a-1].disabled=!1,r=!0;r&&n.scrollArr[2].reload(c)}var n,r=t.data,a=t.indexArr,o=t.onOkAction,s=t.datamodel,c=r[2];return n=new e({data:r,indexArr:a,datamodel:s,changedArr:[function(){i()},function(){i()}],onOkAction:function(t){o(t),n.hide()}}),n.show(),n},selectCardDate:function(t,e,i,n){function r(e){var r=e[0],c=e[1],l=(e[2],r.id+"-"+((c.id<10?"0":"")+c.id)+"-"+((c.id<10?"0":"")+c.id));t.isValidDateStr(l)?(o.html(l),i&&(a.passengers[0].ictl=l,n.set(a))):s.showToast("日期格式不正确，请重新选择！",3,function(){},!0)}var a,o=this.$el.find("#card_date"),s=this,c=2e3,l=(new Date).getFullYear()+100,d=t._calculateSelectDate(c,l);return i&&(a=s.selectInitbookingParam()),t._createDateSelect({data:d,indexArr:t.formatInitDate($.trim(o.text()||""),c),datamodel:{title:"选择证件有效期",tips:""},onOkAction:r},e)},formatInitDate:function(t,e){var i=new Date,n=t&&t.split("-");return 3===n.length&&n[0]&&n[1]&&n[2]&&(i=new Date(n[0],n[1]-1,n[2])),[i.getFullYear()-e,i.getMonth(),i.getDate()-1]}}),define("TicketSearch",["require","cCoreInherit","GSearch","TicketCommand"],function(t){var e=t("cCoreInherit"),i=t("GSearch"),n=t("TicketCommand"),r=new e.Class(i,{getCommand:function(){return n.getInstance()}});return r}),define("TicketUtil",[],function(){return{findDataByKeys:function(){var t=function(e,i){var n,r=[],a=Array.prototype.slice.call(arguments,2);return a.length?(e=e[a.shift()],_.isArray(e)?e.forEach(function(e){var n=t.apply(null,[e,i].concat(a));n&&(r=r.concat(n))}):a.length?n=t.apply(null,[e[a.shift()],i].concat(a)):_.isFunction(i)?n=i(e):i===e&&(n=e),n&&(r=r.concat(n)),r):[]};return t}(),setDefaultValue:function(t,e){t=t||{};for(var i in e)t[i]=t[i]||e[i]}}}),define("TicketCityService",["require","cCoreInherit","cHybridShell","cGeoService","GStoreFactory","TicketModel","TicketConfig","TicketStore","TicketUtil","GCtripCityService"],function(t){var e=t("cCoreInherit"),i=t("cHybridShell"),n=(t("cGeoService"),t("GStoreFactory"),t("TicketModel")),r=t("TicketConfig"),a=t("TicketStore"),o=t("TicketUtil"),s=t("GCtripCityService"),c=new e.Class(s,{initialize:function($super){$super(_.extend({geoLocationStore:a.TicketGeoLocationStore,selectedCityStore:a.TicketSelectedCityStore,lastGeoCityStore:a.TicketLastGeoCityStore,geoCityStore:a.TicketGeoCityStore},r))},getCachedCtripCity:function(t){var e=new i.Fn("get_cached_ctrip_city",t);e.run()},positionByCtripCity:function(){if(!Lizard.isHybrid)return void this.position();var t=function(t){t?this.onCityComplete(t):this.position()}.bind(this);this.getCachedCtripCity(t)},getCityInfo4Index:function(){if(!Lizard.isHybrid)return void this._getCityInfo4Index();var t=function(t){t?this.onCityComplete(t):this._getCityInfo4Index()}.bind(this);this.getCachedCtripCity(t)},_getCityInfo4Index:function(){var t=function(t){return((new Date).getTime()-t)/1e3>60*r.posDuration};return function(){var e=this.geoLocationStore.get();e&&e.time&&!t(e.time)?this.logger.log("getCityInfo4Index","do nothing"):(this.logger.log("getCityInfo4Index","do position!"),e&&e.time&&this.logger.log("getCityInfo4Index","time diff",((new Date).getTime()-e.time)/1e3),this.geoLocationStore.setAttr("time",(new Date).getTime()),this.position())}}(),getCityList:function(t,e,i){var r=n.TicketCityListModel.getInstance();r.excute(function(n){n&&n.citymap&&0===_.size(n.citymap)?e&&e.call(i):t&&t.call(i,n)},function(){e&&e.call(i)},!1,i)},abortGetCityList:function(){var t=n.TicketCityListModel.getInstance();t.abort()},getLocation:function(){var t=a.TicketGeoLocationStore.getInstance().get()||{};return o.setDefaultValue(t,{lng:"",lat:""}),t}});return c}),define("TicketUrlUtil",["cUtility","cGuider","GUrlUtil","TicketStore","GLogger","TicketCityService"],function(t,e,i,n,r,a){var o=e,s=a.getInstance();return window.Ticket={P:function(t){var e=i.getSearch(),n=i.query2json(e);return n[t]||""}},$.extend(i,{getListUrl:function(t,e,i,n,r){if(r&&this._addPositionInfo(n),i=i||"0",e=e||"列表页","k"===t){var a=s.getSelectedCity();a&&(n.scname=a.name)}!n||"1"!==n.smode&&"2"!==n.smode||(n.radiusmax=n.radiusmax||450);var o=Lizard.appBaseUrl+"dest/"+t+"-"+e+"-"+i+"/s-tickets"+this.parseQuery(n);return o},getActivityListUrl:function(t,e,i,n,r){r&&this._addPositionInfo(n),i=i||"0",e=e||"列表页";var a=Lizard.appBaseUrl.replace("ticket","activity");return a+"dest/"+t+"-"+e+"-"+i+this.parseQuery(n)},_addPositionInfo:function(t){var e=s.getLocation();e&&"object"==typeof t&&(e.address&&(t.address=e.address),e.lng&&(t.lon=e.lng),e.lat&&(t.lat=e.lat))},parseQuery:function(t){return"string"==typeof t?t:"object"==typeof t?"?"+this.json2query(t,"","from"):""},getDetailUrl:function(t,e){return Lizard.appBaseUrl+"dest/t"+t+".html"+this.parseQuery(e)},deleteFilter:function(t){return["themeids","paymode","isnowuse","lpid","lcid","zscid","zscname","smode","radiusmax","cf","sort","afilter","atotal","ctm_ref","tscrolltop","zscrolltop"].forEach(function(e){delete t[e]}),t},createTicketFilter:function(){var t={};return["themeids","paymode","isnowuse","lpid","lcid","cf"].forEach(function(e){Lizard.P(e)&&(t[e]=Lizard.P(e))}),t},switchBetweenTicketAndActivity:function(t,e){t=parseInt(t);var i=this.getSearch(),n=i?this.query2json(this.getSearch()):{},r=this.createTicketFilter(),a=Lizard.P("afilter");this.deleteFilter(n),a&&_.extend(n,JSON.parse(decodeURIComponent(a))),_.isEmpty(r)||(n.tfilter=encodeURIComponent(JSON.stringify(r))),n.ttotal=e;var c=this.getPathName();t?c=c.replace("/s-tickets",""):c+="/s-tickets",c=c.replace(/p-(\S+)-(\d+)/,function(t,e){return n.keyword=e||n.titlename||"",n.target=n.target||"ticket","k-keyword-0"});var l=c.match(/k-(\S+)-\d+/);if(l){var d=s.getSelectedCity();d&&(n.scid=n.cityid=d.id)}if(Lizard.isHybrid){var h,u=c.match(/^\/(webapp|html5)\/(ticket|activity)\/(\S+)/i),m="activity";u?(h=u[3]+"?"+this.json2url(n),h="index.html#/webapp/"+m+"/"+h):h="index.html#"+c+"?"+this.json2url(n),o.cross({path:m,param:h})}else{c=c.replace(/\/(ticket|activity)/,t?"/activity":"/ticket");var f=location.origin+c+"?"+this.json2url(n);o.jump({targetModel:"h5",url:f,title:""})}}})}),define("ctmCfg",{CTM_URL:{INDEX:{BANNER:"tkt_hp_ban_ukn_{id}",TICKET:"tkt_hp_ltkt_lst",ACTIVITY:"tkt_hp_ttd_lst",NEAR:"tkt_hp_near_lst",TOPIC:"tkt_hp_sub_cp_{id}",TICKET_RECOMMEND:"tkt_hp_sp_dl_{id}",ACTIVITY_RECOMMEND:"tkt_hp_sp_dl_{id}",FOOTER:"tkt_hp_tdo_lst_{id}",CATEGORY:"tkt_hp_tdctg_lst_{id}",THEME:"tkt_hp_theme_lst_{id}",ZB:"tkt_hp_atkt_lst",WIFI:"tkt_hp_wifi_wfp",HOTEL:"tkt_hp_diyshx_lst"},SEARCH:{SUGGEST:"tkt_search_as_ukn",BTN:"tkt_search_s_ukn",HOT:"tkt_search_hot_ukn_{id}",HISTORY:"tkt_search_hst_ukn_{id}"},LIST:{LST_RECOMMEND_ACTIVITY:"tkt_lst_rec_dl_{id}",LST_RECOMMEND_ACTIVITY_MORE:"tkt_lst_mrec_lst",NORS_RECOMMEND:"tkt_nors_rec_dl_{id}",NORS_RECOMMEND_ACTIVITY:"tkt_nors_rec_dl_{id}",NORS_RECOMMEND_MORE:"tkt_nors_mrec_lst",NORS_RECOMMEND_ACTIVITY_MORE:"tkt_nors_mrec_lst"},DETAIL:{POPBTN:"tkt_dl_fl_flin",BTN:"tkt_dl_bk_flin"},BOOKING:{PAUSE_BOOKING:"tkt_flin_stops_dl"},ORDERDETAIL:{BUY:"tkt_odl_bkag_dl",VIEWSPOT:"tkt_odl_ss_dl",ACTIVITY_DETAIL:"tkt_odl_rec_ttddl_{id}",ACTIVITY_MORE:"tkt_odl_mrec_actlst"},BOOKINGCOMPLETE:{SUCCESS_TO_ORDERDETAIL:"tkt_od_ost_odl",SEE_THEN_SEE:"tkt_od_bya_dl"},ORDERCANCEL:{GOINDEX:"tkt_odl_afc_ukn"}},CTM_KEY:"ctm_ref="}),define("indexSearch",["require","TicketSearch","TicketUrlUtil","TicketStore","ubt","TicketModel","ctmCfg","TicketCityService","TicketCommonService","cUtilCommon","TicketUrlUtil"],function(t){var e=t("TicketSearch"),i=t("TicketUrlUtil"),n=t("TicketStore"),r=t("ubt"),a=t("TicketModel"),o=t("ctmCfg"),s=t("TicketCityService"),c=t("TicketCommonService"),l=t("cUtilCommon"),d=t("TicketUrlUtil"),h=s.getInstance(),u=c.getInstance();return{hideSearch:function(){this.search&&(this.search=this.search.destroy()),this.showList(!0),this.updateHeader(this.getSelectedCity()),this.imgSlider&&this.imgSlider.resizeRefresh()
},showSearch:function(t){this.search&&this.search.destroy(),this.search=new e({keyword:t,placeholder:"景点名称/游玩主题",searchHistoryStore:n.TicketSearchHistoryStore.getInstance(),searchModel:a.TicketSearchModel.getInstance(),parent:this.$el.find("#c-ticket-index-searchwrap"),isShowBackButton:!1,isShowSearchButton:!0,isShowHistory:!0,isShowEmpty:!1,autoFocus:!0,returnHandler:function(){var t=this.search.getValue();if(this.hideSearch(),this.keyword!==t){var e={keyword:encodeURIComponent(t),target:"ticket"};Lizard.isHybrid||(e.from=Lizard.P("from"));var n=i.getListUrl("k","keyword",null,e);this.registerViewBack(),this.pageManager.forward({url:n})}}.bind(this),resultItemCallback:function(t,e,n){var a,s,c={userinput:this.search.getValue(),pagefrom:n?"home_history":"home_assword",rows_searchtbx:$(n?"#historyList":"#resultList").children().size(),clickindex_searchtbx:e+1};switch(t.type){case 2:case 3:a=i.getListUrl("k","keyword",null,_.extend({keyword:encodeURIComponent(t.name),target:"ticket"},c));break;case 4:var d=l.createGuid(),m=_.extend({hash:"index",traceid:d,clientcode:u.getHeaderData()?u.getHeaderData().cid:0,"long":h.getLocation().lng,lat:h.getLocation().lat,poscityid:h.getGeoCity()?h.getGeoCity().id:0,sitecityid:h.getSelectedCity().id,searchtype:"keyword",searchtypevalue:encodeURIComponent(t.name),recordquantity:1},c);this.traceLog.log(r.UBT_URL.INDEX.SEARCH_TO_DETAIL,m,r.UBT_KEY.HOME),a=i.getDetailUrl(t.id,{name:t.name,traceid:d});break;case 5:a=i.getActivityListUrl("ct",t.name,t.id,{target:"ticket"}),s="activity";break;default:a=i.getListUrl("k","keyword",null,_.extend({keyword:encodeURIComponent(t.name),target:"ticket"},c))}this.hideSearch(),this.registerViewBack(),this.pageManager.forward({url:a,path:s,ctm:{key:n?o.CTM_URL.SEARCH.HISTORY:o.CTM_URL.SEARCH.SUGGEST,id:e+1}})}.bind(this),searchCallback:function(t){var e=i.getListUrl("k","keyword",null,{keyword:encodeURIComponent(t),target:"ticket",userinput:t,pagefrom:"home_search"});this.hideSearch(),this.traceLog.log(r.UBT_URL.SEARCH_NEW,{hash:"index"},r.UBT_KEY.HOME),this.registerViewBack(),this.pageManager.forward({url:e,ctm:{key:o.CTM_URL.SEARCH.BTN}})}.bind(this),themeItemCallback:function(t,e){this.traceLog.log(r.UBT_URL.HOTWORD,{hash:"search",keyword:t},r.UBT_KEY.HOME);var i=d.getListUrl("k","keyword",null,{keyword:encodeURIComponent(t),target:"ticket",titlename:t,userinput:this.search.getValue()});this.hideSearch(),this.registerViewBack(),this.pageManager.forward({url:i,ctm:{key:o.CTM_URL.SEARCH.HOT,id:e+1}})}.bind(this),focusCallback:function(){this.showList(!1)}.bind(this),blurCallback:function(){this.showList(!0)}.bind(this)});var s=n.TicketSpecialBannerListStore.getInstance(),c=s.get(),m=c?c.themes||[]:[];this.search.setTheme(m),this.$el.find("#clearHistoryButton").attr("id","ticket-"+this.name+"-clear"),this.$el.find("form .cui-focus-close").attr("id","ticket-"+this.name+"-delete"),this.showList(!1),this.updateHeader(this.getSelectedCity(),!0)}}}),define("indexSideBar",["require","cGuider","ubt","ctmCfg"],function(t){var e=t("cGuider"),i=t("ubt"),n=t("ctmCfg");return{getSideBar:function(t){return[{tagname:"ticket",value:"门票订单",imagePath:"ticket/webresource/res/img/icon_ticket_order.png",callback:function(){var e=this.pageManager.appendCtm({ctm:{key:n.CTM_URL.INDEX.SDBOL},url:"/webapp/myctrip/orders/ticketsorderlist?"+t}).url;Lizard.jump(e)}.bind(this)},{tagname:"activity",imagePath:"ticket/webresource/res/img/icon_activity_order.png",value:"玩乐订单",callback:function(){var e=this.pageManager.appendCtm({ctm:{key:n.CTM_URL.INDEX.SDBTDOL},url:"/webapp/myctrip/orders/localeventorderlist?"+t}).url;Lizard.jump(e)}.bind(this)},{tagname:"more_my_favorite",iconname:"love",value:"我的收藏",callback:function(){var e=this.pageManager.appendCtm({ctm:{key:n.CTM_URL.INDEX.SDBFAVOR},url:"/webapp/favorite/index.html?tagid=TICKET&"+t}).url;Lizard.jump(e)}.bind(this)},{tagname:"more_home",iconname:"home",value:"携程首页",callback:function(){var t={hash:this.name,eventname:"homepage_ctriphome_btn"};this.traceLog.log(null,t,i.UBT_KEY.HOME),this.historyManager.reset(),e.home()}.bind(this)}]}}}),define("ScrollManager",["require","cCoreInherit","TicketConfig"],function(t){var e,i=t("cCoreInherit"),n=t("TicketConfig"),r=Lizard.isHybrid&&n.isIOS7Plus?64:44,a=".js_scroll-box",o="entable-scroll-drag-box enable-scroll-drag-box",s="entable-scroll-drag enable-scroll-drag",c=new i.Class({initialize:function(t){this.wrap=t.wrap,this.scrollNode=t.scrollNode||this.wrap.find(a),this.fixedNode=t.fixedNode,this.followNode=t.followNode,this.hasHeader=void 0===t.hasHeader?!0:!!t.hasHeader,this.top=t.top||0,!Lizard.isHybrid&&$("#main").height("auto"),t.scrollManager||n.scrollManager?this._adjustLayoutInIOS():this._adjustLayoutInAndroid()},_adjustLayoutInAndroid:function(){this.fixedNode&&(this.fixedNode.css({position:"fixed",left:0,right:0,top:Lizard.isHybrid?0:r,"z-index":3}),this.top&&(this.followNode||this.scrollNode).css("padding-top",this.top))},_adjustLayoutInIOS:function(){e||(e=Lizard.isHybrid&&this.hasHeader?document.documentElement.clientHeight+r:document.documentElement.clientHeight),this._adjustWrap(),this._adjustScrollNode()},_adjustWrap:function(){var t=this.hasHeader?e-r:e;this.wrap.height(t),this.wrap.addClass(o)},_adjustScrollNode:function(){var t=this.hasHeader?e-r:e,i=t-this.top;this.scrollNode.height(i),this.scrollNode.addClass(s)},destroy:function(){this.wrap.height("auto"),this.wrap.removeClass(o),this.scrollNode.height("auto"),this.scrollNode.removeClass(s)}});return c.create=function(t){return new c(t)},c}),define("citylistIndexer",["require","TicketConfig","ScrollManager"],function(t){var e=(t("TicketConfig"),t("ScrollManager"),Backbone.View.extend({tpl:_.template(Lizard.T("indexer_tpl")),initialize:function(t){var e=[];_.each(t.data,function(t,i){e.push(i)}),e=e.sort(),this.alphabet=e,this.render(),this.list=["current","history","hot"].concat(e),this.bindIndexerTouch()},bindIndexerTouch:function(){var t,e,i=this,n=this.el,r="current",a=function(n){if(t=$(n.target),!t.attr("data-key"))return void(t=null);t.addClass(r),i.trigger("select",t.attr("data-key"));var a=event.touches[0];e=a.pageY},o=_.throttle(function(n){if(n.preventDefault(),!_.isNull(t)){var a=event.touches[0],o=i.getCurrent(t,a.pageY-e);i.trigger("select",o),i.removeCurrent(),i.$el.find("[data-key="+o+"]").addClass(r)}},100),s=function(){setTimeout(function(){i.removeCurrent()},100)};n.addEventListener("touchstart",a,!1),n.addEventListener("touchmove",o,!1),n.addEventListener("touchend",s,!1),n.addEventListener("touchcancel",s,!1)},removeCurrent:function(){this.$el.find("[data-key]").removeClass("current")},getCurrent:function(t,e){var i=t.height(),n=t.attr("data-key"),r=Math.floor(e/i),a=this.list.indexOf(n)+r;return 0>a?a=0:a>this.list.length-1&&(a=this.list.length-1),this.list[a]},show:function(){this.$el.show()},hide:function(){this.$el.hide()},events:{"click [data-key]":function(t){var e=$(t.target),i="current";e.addClass(i),this.trigger("select",e.attr("data-key")),setTimeout(function(){e.removeClass(i)},88)}},render:function(){this.$el.html(this.tpl({list:this.alphabet}))}}));return e}),define("HistoryManager",["require","cCoreInherit","GHistoryManager","TicketStore"],function(t){var e=t("cCoreInherit"),i=t("GHistoryManager"),n=t("TicketStore"),r=new e.Class(i,{getHistoryStore:function(){return n.TicketHistory.getInstance()},getPageNameRegs:function(){return{list:/dest\/[a-z]+-\S+-[0-9]+\/s-tickets/gi,detail:/dest\/t[0-9]+\.html/gi,detailattr:/jianjie\/[0-9]+\.html/gi,comment:/dest\/t[0-9]+\/p[0-9]+\/comment.html/gi}}});return r}),define("ctm",["ctmCfg"],function(t){function e(e,i,n,r,a){var o,s="",c=i.split("_"),l="[&#]/"+t.CTM_KEY+"[^&#]*/",d=new RegExp(l);return r?s=i:2===c.length&&(s=t.CTM_URL[c[0]][c[1]]),n&&(s=s.replace("{id}",n)),a=!0,o=e.indexOf("?")>0?"&":a?"?":"#",e=e.replace(d,""),e=e+o+t.CTM_KEY+s}return{buildCtmUrl:e}}),define("PageManager",["require","cCoreInherit","GPageManager","HistoryManager","ctmCfg","ctm"],function(t){var e=t("cCoreInherit"),i=t("GPageManager"),n=t("HistoryManager"),r=t("ctmCfg"),a=t("ctm"),o=new e.Class(i,{getCtmCfg:function(){return r},getCtm:function(){return a},getDefaultPath:function(){return"ticket"},getHistoryManager:function(){return n.getInstance()}});return o}),define("TicketTraceLog",["cCoreInherit","cUtility","GUrlUtil","GTraceLog","TicketCommon","CommonStore"],function(t,e,i,n,r,a){var o=a.UserStore.getInstance(),s=new t.Class(n,{__propertys__:function(){},initialize:function(){},getKey:function(t){return t||"Tck_click"},createPageId:function(t){!t.page_id&&t.hash&&(t.page_id=e.isInApp?r.hpageid(t.hash):r.pageid(t.hash),delete t.hash),t.uid="function"==typeof o.getUser&&o.getUser()&&o.getUser().UserID?o.getUser().UserID:0}});return s.getInstance=function(){return this.instance||(this.instance=new this)},s}),define("TicketView",["require","cHybridFacade","PageManager","HistoryManager","TicketStore","TicketCommon","TicketTraceLog","TicketConfig","GView","cGuider"],function(t){var e=t("cHybridFacade"),i=t("PageManager"),n=t("HistoryManager"),r=t("TicketStore"),a=t("TicketCommon"),o=t("TicketTraceLog"),s=t("TicketConfig");GView=t("GView"),Guider=t("cGuider");var c=GView.extend({store:r.TicketGlobalParamStore.getInstance(),pageManager:i.getInstance(),historyManager:n.getInstance(),traceLog:o.getInstance(),createPageId:function(){this.pageid=a.pageid(this.name),this.hpageid=a.hpageid(this.name)},onCreate:function(){GView.prototype.onCreate.call(this,s)},_sendUbt:function(){this.sendUbt&&this.sendUbt(),this.pageid=0,this.hpageid=0},registerViewBack:function(){Lizard.isHybrid&&(e.unregister(e.METHOD_WEB_VEW_DID_APPEAR),e.register({tagname:e.METHOD_WEB_VEW_DID_APPEAR,callback:function(t){this._webviewDidAppear(t)}.bind(this)}))},_webviewDidAppear:function(){this.pageManager.setPageName(this.name),e.unregister(e.METHOD_WEB_VEW_DID_APPEAR)},_removeAttr:function(t){var e=this.store.getAttr(this.name);e&&(delete e[t],this.store.setAttr(this.name,e))},_initParam:function(){var t={},e=Lizard.P("from_native_page");e&&(t.fromNative=!0),$.isEmptyObject(t)||this.store.setAttr(this.name,t)},_returnHandler:function(){var t=this.store.getAttr(this.name);return t&&t.fromNative?(this._removeAttr("fromNative"),Guider.backToLastPage(),!0):!1}});return c}),define("TicketList",["require","TicketView"],function(t){var e=t("TicketView"),i=e.extend({totalPage:0,pageIndex:1,isLoading:!1,offsetY:100,events:{},formatData:function(t){return t},request:function(t,e){e?this.showBottomLoading():this.showLoading(),this.pageIndex=this.listModel.getParam().pidx||1;var i=this.listParamStore.getAll();for(var n in i)this.listModel.setParam(n,i[n]);this.listModel.setParam("pidx",++this.pageIndex),this.isLoading=!0,this.listModel.excute(this.onSuccess,this.onError,!0,this,function(){this.hideLoading(),this.isLoading=!1,this.showToast("加载失败，请稍后再试")})},onSuccess:function(t){this.hideLoading(),this.hideBottomLoading();var e=this.formatData(t);return e||1!==this.pageIndex?void this.appendList(e):void this.showEmpty()},onError:function(t){this.hideLoading(),this.hideBottomLoading(),1===this.pageIndex?(this.els.listContainer.empty(),this.showWarning404(function(){this.hideWarning404(),location.reload()}.bind(this))):(this.isLoading=!1,this.showToast(t.msg||"加载失败，请稍后再试"))},getListHtml:function(){throw new Error("getListHtml method must be override")},appendList:function(t){this.els.listContainer.append(this.getListHtml(t)),this.isLoading=!1},getPageScrollPos:function(t){t===window&&(t=window.document.body);var e=t.scrollLeft,i=t.scrollTop,n=t.clientHeight,r=t.clientWidth,a=t.scrollWidth,o=t.scrollHeight;return{top:i,left:e,height:n,width:r,pageWidth:a,pageHeight:o}},onWindowsScroll:function(){this.isNeedLoadMore()&&this.requestTicketList()},isNeedLoadMore:function(){var t=this.getPageScrollPos(this.scroller);return t.pageHeight-(t.top+t.height)<this.offsetY&&!this.isLoading},requestTicketList:function(){var t=this.listModel.getParam(),e=isNaN(t.pidx)?1:t.pidx;this.totalPage&&e<this.totalPage?this.request(e,!0):this.noMoreNodeShowed||this.renderNoMore()},renderNoMore:function(){this.noMoreNodeShowed=!0;var t='<li class="nomore" style="background:#efefef;">没有更多结果了</li>';this.els.listContainer.append(t)},showBottomLoading:function(){this.bottomLoading||(this.bottomLoading=$('<div class="cui-zl-load" id="zlLoading"> <div class="cui-i cui-b-loading"></div><div class="cui-i  cui-mb-logo"></div> <p>加载中</p></div>'),this.els.listContainer.append(this.bottomLoading)),this.bottomLoading.show()},hideBottomLoading:function(){this.bottomLoading&&(this.bottomLoading.remove(),this.bottomLoading=null)},onCreate:function(){e.prototype.onCreate.call(this),this.els={listContainer:this.$el.find("#c-ticket-list-container"),listTemplate:Lizard.T("c-ticket-list-container-tpl"),emptyNode:this.$el.find(".search_no_results_wrap")},this.listModel.setParam({pidx:1}),this._onWidnowScroll=this.onWindowsScroll.bind(this)},onShow:function(){e.prototype.onShow.call(this),this.isLoading=!1,$(this.scroller||window).bind("scroll",this._onWidnowScroll),$("body").css("overflow-y","auto"),this.els.emptyNode.hide(),this.els.listContainer.children().size()||this.showEmpty()},showEmpty:function(){this.els.emptyNode.show(),this.els.listContainer.hide(),this.noMoreNodeShowed=!0},onHide:function(){e.prototype.onHide.call(this),$(this.scroller||window).unbind("scroll",this._onWidnowScroll),this.hideBottomLoading(),this.listModel&&this.listModel.abort()}});return i}),define("listEmpty",["require","TicketModel","TicketList","TicketCityService","TicketConfig","listConst","ctmCfg","TicketUrlUtil"],function(t){var e=t("TicketModel"),i=t("TicketList"),n=t("TicketCityService"),r=t("TicketConfig"),a=t("listConst"),o=t("ctmCfg"),s=t("TicketUrlUtil"),c=n.getInstance();return{initEmpty:function(){$.extend(this.els,{recommendActivityContainer:this.$el.find("#c-ticket-list-activity"),youContainer:this.$el.find("#c-ticket-list-you"),recommendTicketContainer:this.$el.find("#c-ticket-list-recommend")})},showEmpty:function(){i.prototype.showEmpty.call(this);var t=Lizard.P("type")||"k",e=parseInt(Lizard.P("smode")||0),n=this.bottom.getAllFilterCount();1===e||2===e||"k"!==t&&"ct"!==t&&"n"!==t||n||("k"===t?this.getRecommendYouList(Lizard.P("keyword")):"ct"===t&&this.getGSLocation(Lizard.P("cityid")||Lizard.P("id")))},getRecommendYouList:function(t){var i=e.TicketRecommendYouListModel.getInstance();i.setParam({sword:t,cid:(c.getSelectedCity()||r.defaultCityInfo).id,pindex:1,pcount:1}),i.excute(function(t){t.length&&(this.renderYouList(t),this.requestRecommendTicket(t[0]))},function(){},!0,this)},renderYouList:function(t){if(t.length){this.changeEmptyBk(),Lizard.isHybrid||(t[0].yurl=t[0].yurl+"?from="+encodeURIComponent(window.location.href));var e=_.template(Lizard.T("c-ticket-list-you-tpl"),{keyword:Lizard.P("keyword"),viewspots:t});this.els.youContainer.html(e).show()}},getGSLocation:function(t,i){this.gsLocationModel=e.GSLocationModel.getInstance(),this.gsLocationModel.setParam({dcid:t}),this.gsLocationModel.excute(function(t){t&&t.data?i?i(t.data):this.requestRecommendTicket(t.data):!i&&this.controller.sendNotification(a.LIST_NOTIFICATION.TICKET_RECOMMEND_READY,null)},function(){!i&&this.controller.sendNotification(a.LIST_NOTIFICATION.TICKET_RECOMMEND_READY,null)},!0,this)},requestRecommendTicket:function(t){var i=function(){this.controller.sendNotification(a.LIST_NOTIFICATION.TICKET_RECOMMEND_READY,null)}.bind(this),n=e.TicketListRecommendModel.getInstance(),r={pidx:1,psize:5,radiusmax:300};return t.id=t.id||t.lid||t.cid,t.id?(r.lat=t.lat,r.lon=t.lon,r.distids="1_"+t.id,t.themeids&&t.themeids.length&&(r.spara={themeids:t.themeids}),n.setParam(r),void n.excute(function(e){this.renderRecommendTicket(e,t)}.after(i),i,!0,this)):void i()},renderRecommendTicket:function(t,e){if(t.viewspots.length){this.changeEmptyBk();var i=t.total>5&&("k"===Lizard.P("type")||"ct"===Lizard.P("type")),n=_.template(Lizard.T("c-ticket-list-recommend-tpl"),{keyword:Lizard.P("keyword"),viewspots:t.viewspots,isInApp:Lizard.isHybrid,hasMore:i,cname:e.cname||"周边",dn:e.dn,from:encodeURIComponent(Lizard.isHybrid?"":window.location.href)});this.els.recommendTicketContainer.html(n).show();var r=this.els.recommendTicketContainer.find(".g-pro-view-more");"none"===r.css("display")||r.attr("bind")||(!r.attr("bind")&&r.bind("click",function(){this.showMoreTicket(e)}.bind(this)),r.attr("bind",1))}},showMoreTicket:function(t){var e,i=t.dn||t.cname||"";e=t.lon&&t.lat?s.getListUrl("n",i+"附近",0,{lat:t.lat,lon:t.lon,cityname:i,from:encodeURIComponent(window.location.href),target:Lizard.P("target")},!1):s.getListUrl("ct",t.cname,t.id,{titlename:t.cname,from:encodeURIComponent(window.location.href),target:Lizard.P("target")}),this.pageManager.forward({url:e,ctm:{key:o.CTM_URL.LIST.NORS_RECOMMEND_MORE},trigger:!1})},requestRecommendActivity:function(t){var e=null,i=function(){this.controller.sendNotification(a.LIST_NOTIFICATION.ACTIVITY_RECOMMEND_READY,e)}.bind(this),n=function(t){e=t.data||{},this.updateTabCount(t)};this.requestActivity(t,{},n,i)},requestActivity:function(t,i,n,r){r=r||function(){};var a=e.ActivitySearch4List.getInstance(),o={viewid:0,size:"C_130_130",limit:4};"k"===t?(o.stype=2,o.sval=Lizard.P("keyword"),o.scid=c.getSelectedCity().id):"ct"===t?(o.stype=3,o.sval=Lizard.P("cityid")||Lizard.P("id")):"p"===t||"c"===t?(o.stype=2,o.sval=this.title):"n"===t&&(o.sval=-1,o.stype=-1,o.lon=Lizard.P("lon"),o.lat=Lizard.P("lat"),o.radiusmax=300,o.sort=4,o.limit=5),_.extend(o,i),a.setParam(o),a.excute(n.after(r),r,!0,this)},renderRecommendActivity:function(t,e){if(e=e||3,t.actses.length){this.changeEmptyBk();var i=Lizard.P("type"),n="相关的当地玩乐";"k"===i?n=Lizard.P("keyword")+n:"ct"===i?n=Lizard.P("pname")+n:"n"===i&&(n="附近当地玩乐"),t.actses.forEach(function(t,e){t.link=this.pageManager.appendCtm({url:t.link,ctm:{key:this.totalPage?o.CTM_URL.LIST.LST_RECOMMEND_ACTIVITY:o.CTM_URL.LIST.NORS_RECOMMEND_ACTIVITY,id:e+1,force:!0}}).url+"&from="+encodeURIComponent(Lizard.isHybrid?"":location.href)},this);var r=_.template(Lizard.T("c-ticket-list-activity-tpl"),{title:n,hasMore:t.total>e,actses:t.actses.slice(0,e)});this.els.recommendActivityContainer.html(r).show();var a=this.els.recommendActivityContainer.find(".g-pro-view-more");"none"===a.css("display")||a.attr("bind")||(!a.attr("bind")&&a.bind("click",function(){this.showMoreActivity()}.bind(this)),a.attr("bind",1))}},showMoreActivity:function(){var t={target:Lizard.P("target")},e=Lizard.P("type");"n"===e?(_.extend(t,{lon:Lizard.P("lon"),lat:Lizard.P("lat")}),Lizard.P("address")&&(t.address=Lizard.P("address"))):"ct"===e||"p"===e||"c"===e?_.extend(t,{titlename:Lizard.P("titlename")}):"k"===e&&(t.keyword=Lizard.P("keyword")),Lizard.isHybrid||(t.from=encodeURIComponent(window.location.href));var i=s.getActivityListUrl(Lizard.P("type"),Lizard.P("pname"),Lizard.P("id"),t);this.pageManager.forward({url:i,ctm:{key:this.totalPage?o.CTM_URL.LIST.LST_RECOMMEND_ACTIVITY_MORE:o.CTM_URL.LIST.NORS_RECOMMEND_ACTIVITY_MORE},path:"activity",trigger:!1})},changeEmptyBk:function(){var t=this.$el.find(".ineff_wrap");t.hasClass("mb10")||(t.addClass("mb10"),t=t.find(".cui-load-error"),t&&t.addClass("border-item-b").addClass("bgwh"))}}}),define("TicketBottom",[],function(){var t=[1,7,4,2,3,5,6],e="g-toleft-animation",i="g-sub-toleft-animation",n=Backbone.View.extend({initialize:function(){this.popWrap=this.$el.find(".g-filter-pop-wrap"),this.mask=this.$el.find(".g-mask").hide(),this.mask.unbind("touchmove"),this.mask.bind("touchmove",function(t){t.preventDefault()});var t=this.$el.find(".g-filter-pop-wrap");t.unbind("touchmove touchstart touchend"),t.bind("touchmove touchstart touchend",function(t){var e=["zscid","themeids","pid","cid"].indexOf(t.target.dataset.key);-1===e&&t.preventDefault()}),this.tabWrap=this.$el.find(".g-search-filter-tab"),this.tabs=this.tabWrap.find("li"),this.isnowuseCheckbox=this.$el.find(".ticket-isnowuse span:nth-child(1)"),this.zbCityPop=this.$el.find("#c-ticket-list-zbcitypop"),this.themePop=this.$el.find("#c-ticket-list-themepop"),this.paymodePop=this.$el.find("#c-ticket-list-paymodepop"),this.pList=this.popWrap.find(".g-right-column-location"),this.cList=this.popWrap.find(".g-right-column-sub"),this.filterPop=this.popWrap.find("#c-ticket-list-filterpop"),this.clearFilter=this.filterPop.find(".g-clear-filter"),this.sortPop=this.popWrap.find("#c-ticket-list-listpop"),this.pops={zbcity:this.zbCityPop,theme:this.themePop,filter:this.filterPop,sort:this.sortPop,paymode:this.paymodePop},this.updateFilterCount()},enableDistanceSelection:function(t){this.filterPop.find('.g-left-column.border-item-r ul li[data-index="3"]').show();var e=this.filterPop.find('div[data-index="3"] ul');e.data("lat",t.lat).data("lon",t.lon)},events:{"click .g-search-filter-tab li":"tabAction","click #c-ticket-list-zbcitypop li":"zbCityAction","click #c-ticket-list-zbcitypop .g-clear-filter":"clearZbCityAction","click #c-ticket-list-themepop li":"themeItemAction","click #c-ticket-list-themepop .g-clear-filter":"clearThemeAction","click #c-ticket-list-filterpop .g-clear-filter":"clearAction","click #c-ticket-list-filterpop .g-right-column ul li":"filterRightAction","click #c-ticket-list-filterpop .g-left-column ul li":"filterLeftAction","click #c-ticket-list-paymodepop li":"payModeAction","click #c-ticket-list-listpop li":"sortItemAction","click .g-mask":"hidePopsAndRestoreTabs"},tabAction:function(){var t="g-filter-animation",n="g-pop-show",r=function(e,i){i=!0,i?e.addClass(t).addClass(n):e.removeClass(t).addClass(n)},a=function(e,i){i=!0,i?e.addClass(t).removeClass(n):e.removeClass(t).removeClass(n)},o=function(t){if("isnowuse"===t)return this.checkBoxAction();var e=this.pops[t];if(e.hasClass(n))a(e,!0),this.selectTab();else{for(var i in this.pops)(i===t?r:a)(this.pops[i]);this.selectTab(t)}};return function(t){o.call(this,t.currentTarget.dataset.type),this.pList.removeClass(e),this.cList.removeClass(i)}}(),hidePopsAndRestoreTabs:function(){for(var t in this.pops)if(this.pops[t].hasClass("g-pop-show"))return this.selectTab(),this.hidePops(),!0},zbCityAction:function(t){var e=parseInt(t.currentTarget.dataset.value),i=t.currentTarget.innerText;$(t.currentTarget).hasClass("cur")?this.hidePopsAndRestoreTabs():this.trigger("filterCallback",{zscid:e,zscname:i})},clearZbCityAction:function(){this.trigger("clearCallback","zscid","zscname")},themeItemAction:function(t){var e=parseInt(t.currentTarget.dataset.value),i=$(t.currentTarget).text().trim();$(t.currentTarget).hasClass("cur")?this.hidePopsAndRestoreTabs():this.trigger("filterCallback",{themeids:e,themename:i})},clearThemeAction:function(){this.trigger("clearCallback","themeids","themename")},filterLeftAction:function(t){var n=t.currentTarget.dataset.index;this.filterPop.find(".g-right-column").each(function(t,r){var a=r.dataset.index;n===a?r.style.display="":(r.style.display="none",1===a&&$(r).removeClass(e+" "+i))}),this.filterPop.find(".g-left-column ul li").each(function(t,e){n===e.dataset.index?$(e).addClass("cur"):$(e).removeClass("cur")})},filterRightAction:function(){var t={lcid:Lizard.P("lcid"),lpid:Lizard.P("lpid")},n=function(t){this.cList.find("ul").hide(),this.cList.find('ul[data-pid="'+t+'"]').show(),this.pList.addClass(e),this.cList.addClass(i)},r=function(){this.pList.removeClass(e),this.cList.removeClass(i)},a=function(){this.hidePopsAndRestoreTabs()};return function(e){var i=e.currentTarget.dataset,o=i.key;if("pid"===o)i.pid?n.call(this,i.pid):t.lpid||t.lcid?this.trigger("filterCallback",{lpid:null,lcid:null,cf:"loc"}):a.call(this);else if("cid"===o)i.back?r.call(this):i.pid===t.lpid&&i.cid===t.lcid?a.call(this):this.trigger("filterCallback",{lpid:i.pid,lcid:i.cid,cf:"loc"});else if($(e.currentTarget).hasClass("cur"))a.call(this);else{var s={};if(s[e.currentTarget.dataset.key]=e.currentTarget.dataset.value,"radiusmax"===e.currentTarget.dataset.key){var c=$(e.currentTarget).parent();s.lat=c.data("lat"),s.lon=c.data("lon")}this.trigger("filterCallback",s,e.currentTarget.dataset.key)}}}(),restoreScrollTop:function(){var t=Lizard.P("zscrolltop");t&&this.$el.find(".g-topic-list").eq(0).scrollTop(parseInt(t)),t=Lizard.P("tscrolltop"),t&&this.$el.find(".g-topic-list").eq(1).scrollTop(parseInt(t))},payModeAction:function(t){var e=t.currentTarget.dataset.value;$(t.currentTarget).hasClass("cur")?this.hidePopsAndRestoreTabs():this.trigger("filterCallback","paymode",e)},clearAction:function(){this.trigger("clearCallback")},checkBoxAction:function(){var t=this.isnowuseCheckbox.hasClass("f-checkbox2");this.trigger("isnowuseCallback","isnowuse",!t)},selectTab:function(t){this.tabs.forEach(function(e){$(e)[e.dataset.type===t?"addClass":"removeClass"]("cur")}),this.mask[t?"show":"hide"](),this.trigger("enableScrollCallback",!!t)},getTabWrap:function(){return this.tabWrap},showTabs:function(){this.tabWrap.removeClass("g-search-filter-tab-hide")},hidePops:function(){for(var t in this.pops)this.pops[t].removeClass("g-pop-show");this.pList.removeClass(e),this.cList.removeClass(i)},sortItemAction:function(t){var e=parseInt(t.currentTarget.dataset.sort);$(t.currentTarget).hasClass("cur")?this.hidePopsAndRestoreTabs():this.trigger("sortCallback",e)},selectSortByValue:function(e){this._selectSort(e,t.indexOf(e))},selectSortByIndex:function(e){this._selectSort(t[e],e)},_selectSort:function(t,e){var i=this.tabWrap.find('li[data-type="sort"] span');2===t||6===t?i.eq(0).removeClass("f-arrow-circle-down").addClass("f-arrow-circle-up"):i.eq(0).removeClass("f-arrow-circle-up").addClass("f-arrow-circle-down");var n,r=[];this.sortPop.find("li").each(function(t,i){var r=$(i);e===t?(r.addClass("cur"),n=r):r.removeClass("cur")}),n&&n.find("span").each(function(t,e){r.push(e.innerText)}),i.eq(1).html(r.join(" ")),this.sortPop.removeClass("g-pop-show")},getThemeId:function(){return parseInt(Lizard.P("themeids"))},getPayMode:function(){return Lizard.P("paymode")},getRadiusMax:function(){return parseInt(Lizard.P("radiusmax"))||this.getDefaultRadiusMax()},isNowUse:function(){return"true"===Lizard.P("isnowuse")},updateFilterCount:function(){var t=Lizard.P("type");if("ct"!==t||"p"!==t||"c"!==t){var e=this.getFilterCount(),i=this.tabs.filter('[data-type="filter"]').find("i");i.text(e)[e?"show":"hide"](),this.clearFilter[e?"show":"hide"]()}},getFilterCount:function(){var t=!!this.getPayMode()+!(!Lizard.P("smode")||!this.isNowUse())+!(this.getRadiusMax()===this.getDefaultRadiusMax())+(!!Lizard.P("lpid")||!!Lizard.P("lcid"));return t},getAllFilterCount:function(){var t=!!this.getPayMode()+!!this.isNowUse()+!(this.getRadiusMax()===this.getDefaultRadiusMax())+(!!Lizard.P("lpid")||!!Lizard.P("lcid"))+!!this.getThemeId();return t},getDefaultRadiusMax:function(){return Lizard.P("smode")?450:300}});return n}),define("listBottom",["require","TicketUrlUtil","TicketConfig","ubt","TicketBottom","Headroom"],function(t){var e=t("TicketUrlUtil"),i=t("TicketConfig"),n=t("ubt"),r=t("TicketBottom"),a=t("Headroom");return{initBottom:function(t){this.bottom=new r(t);var e=["isnowuseCallback","sortCallback","filterCallback","clearCallback","enableScrollCallback"];e.forEach(function(t){this.listenTo(this.bottom,t,this[t].bind(this))},this),this.bottom.selectSortByValue(parseInt(Lizard.P("sort")||1)),this.bottom.updateFilterCount()},enableScrollCallback:function(t){this.headroom&&t?this.headroom.destroy():this.initHeadRoom(),i.scrollManager?$(this.scroller).css("overflow-y",t?"hidden":"scroll"):$(document.body).css("overflow-y",t?"hidden":"auto")},clearCallback:function(){var t=["themename","paymode","radiusmax","pcategorys","lpid","lcid","cf","tsrolltop","zscrolltop"];Lizard.P("smode")&&t.push("isnowuse");var i=e.query2json(e.getSearch())||{},n=arguments.length?Array.prototype.slice.call(arguments):t;n.forEach(function(t){delete i[t]}),this.bottom.hidePopsAndRestoreTabs(),this.forward(e.getListUrl(Lizard.P("type"),Lizard.P("pname"),Lizard.P("id"),i))},filterCallback:function(t,e){this._changeQueryAndReload(t,e)},sortCallback:function(t){this._changeQueryAndReload("sort",t)},isnowuseCallback:function(t,e){this._changeQueryAndReload(t,e)},_changeQueryAndReload:function(t,i){this.bottom.hidePopsAndRestoreTabs();var r=e.getSearch();if(r=e.query2json(r),_.isObject(t)){_.extend(r,t),i&&(r.cf=i);for(var a in t)!t[a]&&delete r[a]}else if(t&&(i?r[t]=i:delete r[t]),"sort"!==t&&Lizard.P("smode")&&"isnowuse"===t&&"themeids"!==t){var o=Lizard.P("type");("ct"!==o&&"p"!==o&&"c"!==o||"paymode"!==t)&&(r.cf=t)}var s=this.$el.find(".g-topic-list").eq(0).scrollTop();s?r.zscrolltop=s:delete r.zscrolltop;var c=this.$el.find(".g-topic-list").eq(1).scrollTop();c?r.tscrolltop=c:delete r.tscrolltop,this.traceLog.log(null,_.extend(_.clone(r),{eventname:"filter_button",hash:this.name,themeids:Lizard.P("themeids"),paymode:Lizard.P("paymode"),isnowuse:Lizard.P("isnowuse"),radiusmax:Lizard.P("radiusmax"),sort:Lizard.P("sort"),city:Lizard.P("lcid")||Lizard.P("zscid")||Lizard.P("id"),listtype:"ct"===Lizard.P("type")?["l","a","la"][parseInt(Lizard.P("smode")||0)]:""}),n.UBT_KEY.LIST),this.forward(e.getListUrl(Lizard.P("type"),Lizard.P("pname"),Lizard.P("id"),r))},initWatchDog:function(){this.scroller.addEventListener("scroll",function(){!this.tid&&this.startWatchDog()}.bind(this)),this.$el.bind("click",function(){!this.tid&&this.startWatchDog()}.bind(this))},startWatchDog:function(){this.tid=setTimeout(function(){this.bottom.showTabs(),this.tid=clearTimeout(this.tid)}.bind(this),3e3)},initHeadRoom:function(){this.headroom&&this.headroom.destroy(),this.headroom=new a(this.bottom.getTabWrap()[0],{offset:0,tolerance:0,classes:{initial:"headroom",pinned:"",unpinned:"g-search-filter-tab-hide",top:"",notTop:""},onUnpin:function(){this.bottom.hidePops()}.bind(this),scroller:this.scroller}),this.headroom&&this.headroom.init()}}}),define("listSearch",["require","TicketSearch","TicketUrlUtil","TicketStore","ubt","ctmCfg","TicketModel","TicketCityService","TicketCommonService","cUtilCommon"],function(t){var e=t("TicketSearch"),i=t("TicketUrlUtil"),n=t("TicketStore"),r=t("ubt"),a=t("ctmCfg"),o=t("TicketModel"),s=t("TicketCityService"),c=t("TicketCommonService"),l=(t("cUtilCommon"),s.getInstance()),d=c.getInstance();return{hideSearch:function(){this.search&&(this.search=this.search.destroy()),this.initHeader(!0),this.showList(!0)},showSearch:function(t){this.search&&this.search.destroy(),this.search=new e({keyword:t,searchHistoryStore:n.TicketSearchHistoryStore.getInstance(),searchModel:o.TicketSearchModel.getInstance(),parent:this.$el.find("article"),isShowBackButton:!1,isShowSearchButton:!0,isShowHistory:!0,isShowEmpty:!1,autoFocus:!0,returnHandler:function(){var t=this.search.getValue();if(this.hideSearch(),this.keyword!==t){var e={keyword:encodeURIComponent(t),target:Ticket.P("target")||"ticket"};Lizard.isHybrid||(e.from=Ticket.P("from"));var n=i.getListUrl("k","keyword",null,e);this.pageManager.forward({url:n,trigger:!1,replace:!0})}}.bind(this),resultItemCallback:function(t,e,n){var o,s,c=parseInt(t.type),h={userinput:this.search.getValue(),pagefrom:n?"list_history":"list_assword",rows_searchtbx:$(n?"#historyList":"#resultList").children().size(),clickindex_searchtbx:e+1};switch(c){case 2:case 3:o=i.getListUrl("k","keyword",null,_.extend({keyword:encodeURIComponent(t.name),target:"ticket"},h));break;case 4:var u=_.extend({hash:"list",traceid:this.traceId,clientcode:d.getHeaderData()?d.getHeaderData().cid:0,"long":l.getLocation().lng,lat:l.getLocation().lat,poscityid:l.getGeoCity()?l.getGeoCity().id:0,sitecityid:l.getSelectedCity().id,searchtype:"keyword",searchtypevalue:encodeURIComponent(t.name),recordquantity:1},h);this.traceLog.log(r.UBT_URL.LIST_SEARCH_TO_DETAIL,u,r.UBT_KEY.LIST),o=i.getDetailUrl(t.id,{name:t.name,traceid:this.traceId});break;case 5:o=i.getActivityListUrl("ct",t.name,t.id,{target:"ticket"}),s="activity";break;default:o=i.getListUrl("k","keyword",null,_.extend({keyword:encodeURIComponent(t.name),target:"ticket"},h))}this.hideSearch(),this.pageManager.forward({url:o,path:s,trigger:4===c,ctm:{key:n?a.CTM_URL.SEARCH.HISTORY:a.CTM_URL.SEARCH.SUGGEST,id:e+1},replace:3===c})
}.bind(this),searchCallback:function(t){var e=i.getListUrl("k","keyword",null,{keyword:encodeURIComponent(t),target:Ticket.P("target")||"ticket",userinput:t,pagefrom:"list_search"});this.traceLog.log(r.UBT_URL.SEARCH_NEW,{hash:"list"},r.UBT_KEY.LIST),this.hideSearch(),this.pageManager.forward({url:e,ctm:{key:a.CTM_URL.SEARCH.BTN},trigger:!1,replace:!0})}.bind(this),themeItemCallback:function(t,e){this.traceLog.log(r.UBT_URL.HOTWORD,{hash:"search",keyword:t},r.UBT_KEY.LIST);var n=i.getListUrl("k","keyword",null,{keyword:encodeURIComponent(t),titlename:t,target:"ticket",userinput:this.search.getValue()});this.hideSearch(),this.pageManager.forward({url:n,ctm:{key:a.CTM_URL.SEARCH.HOT,id:e+1},trigger:!1,replace:!0})}.bind(this),focusCallback:function(){this.showList(!1)}.bind(this),blurCallback:function(){this.showList(!0)}.bind(this)});var s=n.TicketSpecialBannerListStore.getInstance(),c=s.get(),h=c?c.themes||[]:[];this.search.setTheme(h),this.$el.find("#clearHistoryButton").attr("id","ticket-"+this.name+"-clear"),this.$el.find("form .cui-focus-close").attr("id","ticket-"+this.name+"-delete"),this.initHeader(!1),this.showList(!1)}}}),define("tLazyLoad",["libs"],function(){var t={img_loading:"",img_error:"",isInApp:!1},e=function(e){this.onloading=[],this.onComplete=[],this.onError=[],this.options=$.extend({},t,e||{})},i=function(t,e){var i=Array.prototype.slice,n=i.call(arguments,2);return function(){return t.apply(e,n.concat(i.call(arguments,0)))}};return e.prototype={init:function(t){this.inited!==!0&&(this.inited=!0,t&&this._add(t),this._update=$.proxy(this.update,this),this.bindEvent())},add:function(t){this.inited||this.init(),this._add(t)},_add:function(t){this.imgs=this.imgs?this.imgs.add(t):t,this.options.img_loading&&t.attr("src",this.options.img_loading)},update:function(){if(this.imgs)for(var t,e,n=0,r=this.imgs.length;r>n;n++)if(t=this.imgs[n],e=$(this.imgs[n]),this.elemInViewport(t)&&"true"!==e.attr("data-loaded")){var a=new Image,o=i(function(t,e){this.triggerComplete(t),e.attr("data-loaded",!0),e.attr("src",e.attr("data-src")),e.addClass("fade-in")},this,t,e),s=i(function(t,e){this.triggerError(),e.attr("data-loaded",!0),this.options.img_error&&e.attr("src",this.options.img_error)},this,t,e);$(a).bind("error",s).bind("load",o),a.src=e.attr("data-src")}},elemInViewport:function(t){var e=t.getBoundingClientRect(),i=this.options.isInApp?0:48,n=0;return e.top+e.height>=i&&e.left+e.width>=n&&e.top<=(window.innerHeight||document.documentElement.clientHeight)},bindEvent:function(){$(window).bind({scroll:this._update,resize:this._update})},unbindEvent:function(){$(window).unbind({scroll:this._update,resize:this._update})},listenComplete:function(t){this.onComplete.push(t)},triggerComplete:function(t){for(var e,i=0,n=this.onComplete.length;n>i;i++)e=this.onComplete[i],"function"==typeof e&&e.call(t)},lisenError:function(t){this.onError.push(t)},triggerError:function(t){for(var e,i=0,n=this.onError.length;n>i;i++)e=this.onError[i],"function"==typeof e&&e.call(t)},listenLoading:function(t){this.onloading.push(t)},triggerLoading:function(t){for(var e,i=0,n=this.onloading.length;n>i;i++)e=this.onloading[i],"function"==typeof e&&e.call(t)},destroy:function(){this.inited=!1,this.imgs=null,this.unbindEvent()}},e});