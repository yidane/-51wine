<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta content="yes" name="apple-mobile-web-app-capable" />
    <meta content="black" name="apple-mobile-web-app-status-bar-style" />
    <meta content="telephone=no" name="format-detection" />
    <meta content="email=no" name="format-detection" />
    <title>我的优惠券</title>
    <link href="styles/reset.css" rel="stylesheet" type="text/css" />
    <link href="styles/ticket.css" rel="stylesheet" type="text/css" />
    <link href="styles/myCoupons.css" rel="stylesheet" />
    <style>
        html {
            font-size: 12px;
        }


        @media screen and (max-height:481px) {
            html {
                font-size: 11px;
            }
        }


        @media screen and (min-height:481px) and (max-height:569px) {
            html {
                font-size: 11px;
            }
        }

        @media screen and (min-height:570px) and (max-height:668px) {
            html {
                font-size: 12px;
            }
        }
    </style>

</head>



<body class="bg">


    <!--loading-->
    <div id="loadingBox">
        <div id="loading"></div>
        <div id="loadingTips">0%</div>
    </div>

    <div id="div_content" style="display:none">
        <ul class="tab coupons-tab" id="menu">
            <li class="active" data-bind="css:{active:selectedType()=='unExpired'},click: changeCoupon.bind($data, 'unExpired')">
                <a href="javascript:void(0);" data-bind="text:'未过期('+ unExpiredCoupons().length+')'">未过期(0)</a>
            </li>
            <li data-bind="css:{active:selectedType()=='used'},click: changeCoupon.bind($data, 'used')">
                <a href="javascript:void(0);" data-bind="text:'已使用('+ usedCoupons().length+')'">已使用(0)</a>
            </li>
            <li data-bind="css:{active:selectedType()=='expired'},click: changeCoupon.bind($data, 'expired')">
                <a href="javascript:void(0);" data-bind="text:'已过期('+ expiredCoupons().length+')'">已过期(0)</a>
            </li>
        </ul>
        <div data-bind="visible:selectedType()=='unExpired'">
            <ul class="coupons-list" data-bind="foreach:unExpiredCoupons ,visible:unExpiredCoupons().length>0" style="display: none;">
                <li class="clearfix fadeInRight">
                   
                        <div class="top clearfix">
                            <span class="price fl"><em>￥</em>   <!-- ko text:subTitle --><!-- /ko--></span>
                            <div class="info">
                                <h3 data-bind="text:title"></h3>
                                <!--<p>满50元可使用</p>-->
                            </div>
                        </div>
                        <p class="coupons-handle" >
                            <!-- ko text:'有效期：'+ beginTime +' 至 '+endTime --><!-- /ko-->
                            <a class="fr used" data-bind="attr:{href:'couponDetail.html?openId='+$root.openId()+'&couponUsageId='+couponUsageId}">详情</a>
                        </p>
                    
                     
                </li>

            </ul>
            <div data-bind="visible:unExpiredCoupons().length<0">
                <div class="noAccord"></div>
                <div class="noAccordTitle">您还没有符合条件的优惠券</div>
                <div class="noAccordTitle2">暂时没有相关数据</div>
            </div>
        </div>


        <div data-bind="visible:selectedType()=='used'" style="display: none;">
            <ul class="coupons-list" data-bind="foreach:usedCoupons ,visible:usedCoupons().length>0"
                 style="display: none;">
                <li class="clearfix fadeInRight">
 
                         
                             
                                <div class="top clearfix">
                                    <span class="price fl"><em>￥</em>   <!-- ko text:subTitle --><!-- /ko--></span>
                                    <div class="info">
                                        <h3 data-bind="text:title"></h3>
                                        <!--<p>满50元可使用</p>-->
                                    </div>
                                </div>
                                <p class="coupons-handle" >
                                    <!-- ko text:'有效期：'+ beginTime +' 至 '+endTime --><!-- /ko-->
                                    <a class="fr used" data-bind="attr:{href:'couponDetail.html?openId='+$root.openId()+'&couponUsageId='+couponUsageId+'&type=used'}">详情</a>
                                </p>
                                <i class="status-used i-status"></i>
                       
                </li>

            </ul>
            <div data-bind="visible:usedCoupons().length<0">
                <div class="noAccord"></div>
                <div class="noAccordTitle">您还没有符合条件的优惠券</div>
                <div class="noAccordTitle2">暂时没有相关数据</div>
            </div>
        </div>

        <div data-bind="visible:selectedType()=='expired'" style="display: none;">
            <ul class="coupons-list" data-bind="foreach:expiredCoupons ,visible:expiredCoupons().length>0" style="display: none;">
                <li class="fail clearfix fadeInRight">
                    
                        <div class="top clearfix">
                            <span class="price fl"><em>￥</em>   <!-- ko text:subTitle --><!-- /ko--></span>
                            <div class="info">
                                <h3 data-bind="text:title"></h3>
                                <!--<p>满50元可使用</p>-->
                            </div>
                        </div>
                        <p class="coupons-handle">
                            <!-- ko text:'有效期：'+ beginTime +' 至 '+endTime --><!-- /ko-->
                            <a class="fr used" data-bind="attr:{href:'couponDetail.html?openId='+$root.openId()+'&couponUsageId='+couponUsageId+'&type=expired'}">详情</a>
                        </p>
                        <i class="status-expired i-status"></i>
                  
                    
                </li>

            </ul>
            <div data-bind="visible:expiredCoupons().length<0">
                <div class="noAccord"></div>
                <div class="noAccordTitle">您还没有符合条件的优惠券</div>
                <div class="noAccordTitle2">暂时没有相关数据</div>
            </div>
        </div>

    </div>

    <script src="../javaScripts/jquery-2.1.4.min.js"></script>
    <script src="../javaScripts/jquery.url.js"></script>
    <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>

    <script src="../javaScripts/pre-loader.js"></script>
    <script src="../javaScripts/knockout-3.2.0.debug.js"></script>
    <script src="../order/script/common/common.js"></script>
    <script src="../order/script/common/main.js"></script>
    <script src="../js/myCoupons-vm.js"></script>
    <script>
        //根据页面尺寸显示格式
        //var winWidth = $(window).width() > 640 ? 640 : $(window).width();
        //$("html").css("fontSize", (winWidth / 640) * 20 + "px");

        var access_code = "";
         access_code = $.url.param("code");
         if (!access_code) {
             var fromurl = location.href;
             var url = 'https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxdd6127bdb5e7611c&redirect_uri='
                 + encodeURIComponent(fromurl) +
                 '&response_type=code&scope=snsapi_base&state=STATE%23wechat_redirect&connect_redirect=1#wechat_redirect';
             location.href = url;
         }

        var param = {
            access_code: access_code
        };

        var imagesArray = new Array(10).join(',').split(',');
        //imagesArray = imagesArray.map(function (el, i) {
        //    return 'http://dummyimage.com/600x400/000/' + (255 - i) + '?' + +new Date();
        //});

        new preLoader(imagesArray, {
            onProgress: function (src, element, index) {

                var percent = Math.floor((100 / this.queue.length) * this.completed.length);

                // update the progress element
                $("#loadingTips").text(percent + '%');


            },
            onComplete: function (loaded, errors) {
                var myCouponsVM = new MyCouponsViewModel(null, param);
                ko.applyBindings(myCouponsVM);
               

            }
        });

     

    </script>
</body>
</html>
